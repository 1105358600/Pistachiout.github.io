<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-pace-theme-flash.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"pistachiout.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Pistachiout的学习博客">
<meta property="og:type" content="website">
<meta property="og:title" content="Pistachiout的博客">
<meta property="og:url" content="https://pistachiout.github.io/page/3/index.html">
<meta property="og:site_name" content="Pistachiout的博客">
<meta property="og:description" content="Pistachiout的学习博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Pistachiout">
<meta property="article:tag" content="博客">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://pistachiout.github.io/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Pistachiout的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="Pistachiout的博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/Pistachiout" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Pistachiout的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">每天多学一点知识,就少写一行代码</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>
    <link rel="stylesheet" href="/dist/APlayer.min.css">
        <div id="aplayer"></div>
        <script type="text/javascript" src="/dist/APlayer.min.js"></script>
        <script type="text/javascript" src="/dist/music.js"></script>
    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pistachiout.github.io/wiki/Nginx%E9%AB%98%E5%B9%B6%E5%8F%91%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Pistachiout">
      <meta itemprop="description" content="Pistachiout的学习博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pistachiout的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/wiki/Nginx%E9%AB%98%E5%B9%B6%E5%8F%91%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-16 18:54:55" itemprop="dateCreated datePublished" datetime="2023-02-16T18:54:55+08:00">2023-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-15 10:15:29" itemprop="dateModified" datetime="2023-02-15T10:15:29+08:00">2023-02-15</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>目前，互联网已经得到了广泛的普及与应用，个人电脑和移动设备的发展,使得即时信息与娱乐服务变的更加方便精巧,基础用户的不断增加使得应用访问量变得巨大。为了提供安全可靠的服务,服务器端正在面临着越来越大的压力。传统的服务器多线程业务逻辑设计在大量用户访问时支撑并发连接的能力有限，不利于构建高性能服务器架构。Nginx 作为当下的高并发连接的负载均衡服务器因其极强的性能得到广泛的使用。本文主要对高并发Nginx进行详细的介绍，重点说明使用Nginx实现Web系统的高并发的原理。</p>
<h1 id="一、Web系统高并发性"><a href="#一、Web系统高并发性" class="headerlink" title="一、Web系统高并发性"></a><strong>一、Web系统高并发性</strong></h1><h2 id="（一）高并发概念"><a href="#（一）高并发概念" class="headerlink" title="（一）高并发概念"></a>（一）高并发概念</h2><p>高并发在外行人眼里似乎很高大上，但其实并不难理解，它指的就是我们通过各种设计使得系统能够在同一时间并行处理很多请求。一般来说高并发是一个结果导向的东西，现实中的例子也不少。常见的高并发场景有：双11时淘宝等系统处理大量购物者的购物请求、选课时的学校选课系统、春节时12306网站处理大量的购票请求、微博出现各种惊人热搜等，高并发的概念并不是突然出现的，而是随着业务的发展而产生的需求。高并发的业务场景出现了，随之而来的就是要支持这个高并发业务场景的架构——技术要为业务服务，业务倒逼技术发展，高并发是随着业务发展的。</p>
<h2 id="（二）高并发指标"><a href="#（二）高并发指标" class="headerlink" title="（二）高并发指标"></a>（二）高并发指标</h2><p>接下来分析高并发的指标。高并发并不意味着仅仅只追求高性能。从宏观的角度来看，高并发系统有三个基本的设计目标，分别是高性能、高可用以及高可扩展性，而这三方面并不是孤立存在的，它们彼此之间是可以相互支撑的。</p>
<ol>
<li>高性能：性能主要体现了系统的并行处理能力，在有限的硬件投入下，提高性能就意味着能节省成本。衡量软件性能包括了响应时间、TPS、服务器资源利用率等客观指标，也可以是用户的主观感受（从程序员、业务用户、终端用户&#x2F;客户不同的视角，可能会得出不同的结论）。</li>
<li>.高可用性：可用即表示一般情况下系统可以正常服务的时间，指系统具有较高的无故障运行能力，可用性 &#x3D; 平均故障时间 &#x2F; 系统总运行时间。一个全年无故障，能够正常服务；而另一个过不久就出线上事故、宕机，那么用户肯定会选择前者，另外，如果系统可用性过低，也一定会大大拖累业务。</li>
<li>高扩展：表示的是系统处理的扩展能力。在流量高峰时能否在短时间内完成扩容，更平稳地承接峰值流量，比如双11、微博各种惊人热搜等流量巨大时的扩展能力。面对突发流量，不可能临时改造架构，最快的方式就是增加机器来线性提高系统的处理能力。从高并发系统的整体架构角度来看，扩展的目标不仅仅是把服务设计成无状态就行了，因为当流量增加 10 倍，业务服务可以快速扩容 10 倍，但是数据库可能就成为了新的瓶颈。我们需要站在整体架构的角度，而不仅仅是业务服务器的角度来考虑系统的扩展性，所以说，数据库、缓存、依赖的第三方、负载均衡、交换机带宽等等都是系统扩展时需要考虑的因素。我们要知道系统并发到了某一个量级之后，哪一个因素会成为我们的瓶颈点，从而针对性地进行扩展[1]。</li>
</ol>
<h2 id="（三）高并发架构实现的方法"><a href="#（三）高并发架构实现的方法" class="headerlink" title="（三）高并发架构实现的方法"></a>（三）高并发架构实现的方法</h2><p>高并发的解决方案包括以下几种：</p>
<ul>
<li><p>·	流量优化： 防盗链处理（把一些恶意的请求拒之门外） ·	</p>
</li>
<li><p>前端优化：减少HTTP请求、添加异步请求、启用浏览器的缓存和文件压缩、CDN加速、建立独立的图片服务器； ·</p>
</li>
<li><p>服务端优化：页面静态化处理、并发处理、队列处理； ·	.</p>
</li>
<li><p>数据库优化：数据库的缓存、分库分表、分区操作、读写分离、负载均衡；</p>
</li>
<li><p>Web服务器优化：负载均衡。[3]</p>
</li>
</ul>
<p>以上案例总而言之在方法论上主要有两种：<strong>垂直扩展（Scale Up）与水平扩展（Scale Out）</strong>。<br><strong>垂直维度</strong>主要是针对单台计算机，通过升级软、硬件能力实现性能提升；水平维度则主要针对集群系统，利用合理的任务分配与任务分解实现性能的提升。垂直维度可包括以下措施：</p>
<ul>
<li>提升单机的硬件性能：通过增加内存、 CPU核数、存储容量、或者将磁盘 升级成SSD等堆硬件的方式来提升。</li>
<li>·提升单机的软件性能：使用缓存减少IO次数，使用并发或者异步的方式增加吞吐量。</li>
</ul>
<p><strong>水平维度</strong>可包括以下措施：</p>
<ul>
<li>·做好分层架构：这是横向扩展的前提，因为高并发系统往往业务复杂，通过分层处理可以简化复杂问题，更容易做到水平扩展。</li>
<li>·各层进行水平扩展：无状态水平扩容，有状态做分片路由。</li>
</ul>
<p>业务集群通常能设计成无状态的，而数据库和缓存往往是有状态的，因此需要设计分区键做好存储分片，当然也可以通过主从同步、读写分离的方案提升读性能。[2]</p>
<p>用一个比喻，你想要一个人打十个人，这时候就得想办法了。第一个办法就是努力锻炼自己，然后全副武装，这就是垂直扩展；第二个办法，你一看对面人多，你叫10多个兄弟，然后你们二十个打他们十个，这就是水平扩展；此外还有第三个不常用的办法，你找个门把住，每次就放一个大汉进来，打倒一个再放下一个，这个就是削峰限流的做法。<br>从上面举的例子容易看出，垂直维度方案比较适合业务阶段早期和成本可接受的阶段，该方案是提升性能最简单直接的方式，但是受成本与硬件能力天花板的限制。而水平维度方案所带来的好处一般在业务发展的后期才能体现出来，但是没有垂直方案的天花板问题。一旦达到一定的业务阶段，水平维度是技术发展的必由之路。</p>
<p>本文主要从理论层面研究水平维度上利用Nginx在web服务器上来实现一定的高并发的原理。</p>
<h1 id="二、Nginx实现高并发"><a href="#二、Nginx实现高并发" class="headerlink" title="二、Nginx实现高并发"></a>二、Nginx实现高并发</h1><p>Nginx是一款是由程序设计师Igor Sysoev所开发的高性能的 Web和 反向代理服务器，也是一个 IMAP&#x2F;POP3&#x2F;SMTP 代理服务器，以其高性能，稳定性，丰富的功能，简单的配置和低资源消耗而闻名。很多高知名度的网站都使用 Nginx，比如：Netflix，GitHub， SoundCloud， MaxCDN 等。[4]在高连接并发的情况下，Nginx是Apache服务器不错的替代品。Nginx的内存占用少，启动极快，高并发能力强，在互联网项目中广泛应用。官方测试Nginx能够支撑5万并发链接，并且CPU、内存等资源消耗却非常低，运行非常稳定。<br>Nginx的主要着眼点就是其高性能以及对物理计算资源的高密度利用，因此其采用了不同的架构模型。受启发于多种操作系统设计中基于“事件”的高级 处理机制，Nginx采用了模块化、事件驱动、异步、单线程及非阻塞的架构，并大量采用了多路复用及事件通知机制。在Nginx中，连接请求由为数不多的几个仅包含一个线程的进程worker以高效的回环(run-loop)机制进行处理，而每个worker可以并行处理数千个的并发连接及请求。[5]</p>
<h2 id="（一）-Nginx实现高并发的整体架构"><a href="#（一）-Nginx实现高并发的整体架构" class="headerlink" title="（一） Nginx实现高并发的整体架构"></a>（一） Nginx实现高并发的整体架构</h2><p>Nginx 启动时，会生成两种类型的进程，一个是主进程 （master），一个或多个工作进程（worker），因此，Nginx 启动以后，查看操作系统的进程列表，我们就能看到至少有两个Nginx进程。master进程并不处理网络请求，主要负责调度和监控工作进程，接收外部的操作（信号），服务器实际处理网络请求及响应的是工作进程，在类 unix 系统上，Nginx可以配置多个工作进程，而每个工作进程都可以同时处理数以千计的网络请求，而工作进程包括核心和功能性模块，核心模块负责维持一个运行循环，执行网络请求处理的不同阶段的模块功能，也使得我们可以根据需要对功能模块进行适当的选择和修改，编译成具有特定功能的服务器。</p>
<h2 id="（二）-Nginx实现高并发的模块化设计"><a href="#（二）-Nginx实现高并发的模块化设计" class="headerlink" title="（二） Nginx实现高并发的模块化设计"></a>（二） Nginx实现高并发的模块化设计</h2><p>高度模块化的设计是 Nginx 的架构基础。1.核心模块：Nginx 服务器正常运行必不可少的模块，提供错误日志记录、配置文件解析、事件驱动机制、进程管理等核心功能。2.标准 HTTP 模块提供 HTTP 协议解析相关的功能。3.可选HTTP模块主要用于 扩展 标准的 HTTP 功能，让 Nginx 能处理一些特殊的服务。4.邮件服务模块主要用于支持 Nginx 的 邮件服务。5.第三方模块是为了扩展 Nginx 服务器应用，完成开发者自定义功能。Nginx服务器被分解为多个模块 ，每个模块就是一个功能模块 ，只负责自身的功能，模块之间严格遵循 “高内聚，低耦合”的原则，这有利于高并发的实现。[6]</p>
<h2 id="（三）-Nginx实现高并发的请求方式处理"><a href="#（三）-Nginx实现高并发的请求方式处理" class="headerlink" title="（三） Nginx实现高并发的请求方式处理"></a>（三） Nginx实现高并发的请求方式处理</h2><p>Nginx结合多进程机制和异步机制中的异步非阻塞方式。<br>服务器每当收到一个客户端时，就有服务器主进程生成一个子进程出来和客户端建立连接进行交互，直到连接断开，该子进程就结束了。使用多进程的好处是各个进程之间相互独立，不需要加锁，减少了使用锁对性能造成影响，同时降低编程的复杂度，降低开发成本。其次，采用独立的进程，如果一个进程发生异常退出时，其它进程正常工作， master进程则很快启动新的工作进程，确保服务不会中断，从而将风险降到最低。<br>每个工作进程使用异步非阻塞方式，可以处理多个客户端请求。当某个工作进程接收到客户端的请求以后，调用 IO 进行处理，如果不能立即得到结果，就去处理其他请求（非阻塞），而客户端在此期间也无需等待响应，可以去处理其他事情（异步）当IO返回时，就会通知此工作进程，该进程得到通知，暂时挂起当前处理的事务去响应客户端请求。Nginx 的异步非阻塞工作方式正把当中的等待时间利用起来了。在需要等待的时候，这些进程就空闲出来待命了，因此表现为少数几个进程就解决了大量的并发问题。</p>
<h2 id="（四）-Nginx实现高并发的进程处理模型"><a href="#（四）-Nginx实现高并发的进程处理模型" class="headerlink" title="（四） Nginx实现高并发的进程处理模型"></a>（四） Nginx实现高并发的进程处理模型</h2><p>Nginx 在启动后，会有一个主进程和多个相互独立的工作进程，主进程负责接收来自外界的信号，向各工作进程发送信号，每个进程都有可能来处理这个连接。主进程能监控工作进程的运行状态，当工作进程由于异常情况退出后，会自动启动新的工作进程。每进来一个请求，会有一个工作进程去处理。但不是全程的处理，处理到可能发生阻塞的地方，比如向上游（后端）服务器转发请求，并等待请求返回。那么，这个处理的工作不会这么傻等着，他会在发送完请求后，注册一个事件：“如果upstream返回了，告诉我一声，我再接着干”。于是他就休息去了。此时，如果再有请求进来，他就可以很快再按这种方式处理。而一旦上游服务器返回了，就会触发这个事件，工作才会来接手，这个请求才会接着往下走。<br>由于web server的工作性质决定了每个请求的大部份生命都是在网络传输中，实际上花费在server机器上的时间片不多，这就是为什么几个进程就解决了高并发。每个工作进程都是独立的进程，不共享资源，不需要加锁。采用独立的进程，可以让互相之间不会影响，一个进程退出后，其它进程还在工作，服务不会中断，主进程则很快重新启动新的工作进程。而且 Nginx为了更好的利用多核特性，提供CPU亲缘性的绑定选项，我们可以将某一个进程绑定在某一个核上，这样就不会因为进程的切换 带来 Cache 的失效对于每个请求，有且只有一个工作进程对其处理。[9]</p>
<h2 id="（五）-Nginx实现高并发的反向代理与负载均衡"><a href="#（五）-Nginx实现高并发的反向代理与负载均衡" class="headerlink" title="（五） Nginx实现高并发的反向代理与负载均衡"></a>（五） Nginx实现高并发的反向代理与负载均衡</h2><p>反向代理方式是指以代理服务器来接收internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给Internet上请求连接的客户端，此时代理服务器对外就表现为一个反向代理服务器。反向代理隐藏了真实的服务端，当我们请求 <a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a> 的时候，就像拨打 10086 一样，背后可能有成千上万台服务器为我们服务，但具体是哪一台，你不知道，也不需要知道，你只需要知道反向代理服务器是谁就好了，<a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a> 就是我们的反向代理服务器，反向代理服务器会帮我们把请求转发到真实的服务器那里去。Nginx 就是性能非常好的反向代理服务器，用来做负载均衡。<br>而什么是负载均衡呢？随着请求数的快速增长，单服务器已经无法承担大量用户的并发访问，这个时候，就需要建立服务器集群，来让多台服务器协同工作，提高整体项目的吞吐量和QPS。假设一台设备资源占有率已经饱和，而另一台服务器却只有零星几个请求处理，这显然是不合理的。我们期望多台服务器需要平均承担客户端发来的请求，使每台机器都充分利用。这时，我们就需要用到一种技术，叫做负载均衡。负载均衡是多台服务器组合为一个集群，其中每台机器可以单独运行，服务器之间地位相同，通过负载均衡技术，将客户端发来的请求平均分配到每台服务器中，使得项目的负载能够均衡的分布，每台服务器的资源使用量也基本相同。通过负载均衡技术，使得项目巨额访问量从单台服务器均匀的分摊到每台服务器上。[10][12]<br>Nginx对外表现为服务器, 当接受到客户端的HTTP请求时, 并不产生响应, 但也不同于Squid等其他服务器直接转发, 而是会将用户发来的请求缓存一份, 然后再通过负载均衡算法将完整的请求缓存从它的上游集群服务器中选择合适的进行转发, 而上游服务器处理请求生成的响应会直接转发给Nginx, 此时Nginx会边接受边将响应转发给客户, 而不是完整地缓存到响应再一并转发。这正是Nginx作为反向代理服务器的优势所在。[15]<br>    <strong>Nginx负载均衡主要有三种策略。</strong></p>
<ul>
<li>轮循（默认）：Nginx根据请求次数，将每个请求均匀分配到每台服务器</li>
<li>最少连接：将请求分配给连接数最少的服务器。Nginx会统计哪些服务器的连接数最少。</li>
<li>·IP Hash：绑定处理请求的服务器。第一次请求时，根据该客户端的IP算出一个HASH值，将请求分配到集群中的某一台服务器上。后面该客户端的所有请求，都将通过HASH算法，找到之前处理这台客户端请求的服务器，然后将请求交给它来处理。[16][18]</li>
</ul>
<p>负载均衡对实现高并发有很大作用。<br>一是转发功能按照一定的算法，将客户端请求转发到不同应用服务器上，减轻单个服务器压力，提高系统并发量。<br>二是故障移除：通过心跳检测的方式，判断应用服务器当前是否可以正常工作，如果服务器期宕掉，自动将请求发送到其他应用服务器。<br>第三，恢复添加：如检测到发生故障的应用服务器恢复工作，自动将其添加到处理用户请求队伍中。</p>
<p>通过以上分析可以发现Nginx对比apache服务器的诸多优点。</p>
<ul>
<li>Nginx 更主要是作为反向代理，而非Web服务器使用。</li>
<li>Nginx是事件驱动服务器，最适合做的就是这种 I&#x2F;O 密集型工作，如反向代理。因为进程在一个地方进行计算时，那么这个进程就不能处理其他事件了。</li>
<li>Nginx 只需要少量进程配合事件驱动，而不像 Apache 多进程模型那样大量的进程数。</li>
<li>Nginx处理静态文件效果也很好，那是因为读写文件和网络通信其实都是 I&#x2F;O操作，处理过程一样。</li>
</ul>
<h1 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h1><p>本文介绍了高并发的各种概念以及指标，接着说明了Nginx实现高并发的一些原理，并且对比apache服务器，就Nginx在实现高并发方面的诸多优点进行了分析说明。<br>当然本文只是在原理上做了一些分析，在实际中，高并发没有具体的标准，业务场景不一样，执行复杂度不一样，单看并发量也没有意义，必须结合具体场景进行判断。举个例子，访问百度首页通常情况下都是鼠标点击一下就看到结果了，几乎感觉不到等待时间，且百度每秒处理的访问量也非常的大，而如果支付宝扫描二维码支付，通常需要等较久的时间，这就是业务场景上的差距。再比如配置上的不同，用高配物理机得出的数据和最老最低配的虚拟器上的出来的结果是无法比较的。总之，高并发的本质不是多大算高并发的一个数字，而是从架构上、设计上、编码上怎么来保证或者解决由并发引起的问题。高并发的实际要求以及实现远远不止以上说到的内容，Nginx的实现也有更多的方法，往往要根据处理的业务场景和实际的设备以及要求做出灵活应变。</p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>[1]冰河 海量数据处理与大数据技术实战 北京大学出版社2020-08-01<br>[2]李运华《从零开始学架构》 2021-01-23<br>[3]张开涛 亿级流量网站架构核心技术 电子工业出版社2017年<br>[4]吴宝花 基于Nginx的服务器集群负载均衡策略研究与优化[D].南昌大学,2020.<br>[5]吴翰清 《白帽子讲Web安全 》2012年电子工业出版社<br>[6]杜星. 轻量级Web服务器Nginx的理论与技术研究[D].南京邮电大学,2016.<br>[7]吴陈. 基于Nginx的服务器集群负载均衡策略的研究与改进[D].华南理工大学,2020.<br>[8]刘佳祎,崔建明,智春.基于Nginx服务器的动态负载均衡策略[J].桂林理工大学学报,2020,40(02):403-408.<br>[9]张泽宇. VPPNGX：基于FD.io VPP的高性能Nginx实现[D].上海交通大学,2020.<br>[10]刘茜. 一种基于Nginx负载均衡软件技术实现方法[A]. 天津市电子学会、天津市仪器仪表学会.第三十三届中国（天津）2019’IT、网络、信息技术、电子、仪器仪表创新学术会议论文集[C].天津市电子学会、天津市仪器仪表学会:天津市电子学会,2019:4.<br>[11]刘金秀,陈怡华,谷长乐.基于Nginx的高可用Web系统的架构研究与设计[J].现代信息科技,2019,3(11):94-97.<br>[12]林丽丽.使用高性能Web服务器Nginx实现开源负载均衡[J].大众科技,2010(07):37-38+27.<br>[13]许诺.大数据下基于Nginx负载均衡的教务系统优化设计[J].信息技术与信息化,2021(06):191-193.<br>[14]李刚.Nginx负载均衡技术在高校教务系统中的应用[J].辽宁师专学报(自然科学版),2020,22(03):19-22+32.<br>[15]赵凯.一种基于Nginx反向代理机制的微服务负载均衡方法分析[J].无线互联科技,2020,17(16):140-141.<br>[16]刘旻昊.Nginx服务器“秘籍”[J].中国传媒科技,2018(04):13-14.<br>[17]马原龙. Nginx负载均衡技术研究[D].重庆邮电大学,2016.<br>[18]王艳,陈卫卫.基于Nginx替代Apache在高并发WEB负载均衡系统中的应用[J].电子测试,2015(06):88-92.<br>[19]Castien René F,Coppieters Michel W,Durge Tom S C,ScholtenPeeters Gwendolyne G M. High concurrent validity between digital and analogue algometers to measure pressure pain thresholds in healthy participants and people with migraine: a cross-sectional study.[J]. The journal of headache and pain,2021,22(1):<br>[20]Wang Ling. Design and Implementation of Online Exam Platform Based on High-Concurrency Processing Mode[J]. International Journal of Computational and Engineering,2021,6(2):<br>[21]赵俊哲. 网络流量高并发优化处理研究[D].南京邮电大学,2020.</p>

      
    </div>

    
    
    
 <div>
    
  </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pistachiout.github.io/wiki/%E4%BD%BF%E7%94%A8nvm%E7%AE%A1%E7%90%86node%E7%89%88%E6%9C%AC%EF%BC%8C%E5%AE%9E%E7%8E%B0%E9%AB%98%E7%89%88%E6%9C%AC%E4%B8%8E%E4%BD%8E%E7%89%88%E6%9C%ACnode%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Pistachiout">
      <meta itemprop="description" content="Pistachiout的学习博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pistachiout的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/wiki/%E4%BD%BF%E7%94%A8nvm%E7%AE%A1%E7%90%86node%E7%89%88%E6%9C%AC%EF%BC%8C%E5%AE%9E%E7%8E%B0%E9%AB%98%E7%89%88%E6%9C%AC%E4%B8%8E%E4%BD%8E%E7%89%88%E6%9C%ACnode%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E6%8D%A2/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-16 18:54:55" itemprop="dateCreated datePublished" datetime="2023-02-16T18:54:55+08:00">2023-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-15 10:15:54" itemprop="dateModified" datetime="2023-02-15T10:15:54+08:00">2023-02-15</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="先清空本地安装的node-js版本"><a href="#先清空本地安装的node-js版本" class="headerlink" title="先清空本地安装的node.js版本"></a>先清空本地安装的node.js版本</h2><p>1.按健win+R弹出窗口，键盘输入cmd,然后敲回车（或者鼠标直接点击电脑桌面最左下角的win窗口图标弹出，输入cmd再点击回车键）<img data-src="https://img-blog.csdnimg.cn/bdefb4adcb694be8ba4423b6b3f99926.png" alt="在这里插入图片描述"></p>
<p>然后进入命令控制行窗口，并输入where node查看之前本地安装的node的路径</p>
<p><img data-src="https://img-blog.csdnimg.cn/8d859630827946a2b5764ae86160d76e.png" alt="在这里插入图片描述"></p>
<p>2.找到上面找到的路径，将node.exe所在的父目录里面的所有东西都删除</p>
<p>3.为了彻底删除之前安装的node.js，鼠标点击电脑左面最左下角的win窗口图标弹出，输入“控制面板”再点击回车键进入，进入控制面板后，找到所安装的node.js并卸载。<br><img data-src="https://img-blog.csdnimg.cn/edb98a407d4f4d79909568a5911e2219.png" alt="在这里插入图片描述"></p>
<h2 id="安装nvm管理工具"><a href="#安装nvm管理工具" class="headerlink" title="安装nvm管理工具"></a>安装nvm管理工具</h2><p>1.从官网下载安装包 <a target="_blank" rel="noopener" href="https://github.com/coreybutler/nvm-windows/releases">https://github.com/coreybutler/nvm-windows/releases</a>，下载红框里面的那个<br>，下载后，直接进行安装<br><img data-src="https://img-blog.csdnimg.cn/542179cb24354244b5b8fa80c5599dfe.png" alt="在这里插入图片描述"></p>
<p>2.nvm安装完成后，检验是否安装成功，进入命令控制行窗口（进入方法见前面），<br>输入命令nvm v查看，如果出现版本号，即安装成功（如果安装不成功，查看之前自己安装的node.js有没有删除彻底、安装nvm工过程有没有漏掉什么！）。</p>
<p><img data-src="https://img-blog.csdnimg.cn/308f2578f49544c18e8340b1e65536a8.png" alt="在这里插入图片描述"></p>
<h2 id="安装node-js版本"><a href="#安装node-js版本" class="headerlink" title="安装node.js版本"></a>安装node.js版本</h2><p>(1) 输入命令行nvm ls anaillable查看可用的node.js版本号</p>
<p>(2) 输入命令行nvm install node版本号(例如：nvm install 12.17.0)即可安装对应版本以及自动安装对应的npm版本。<br><img data-src="https://img-blog.csdnimg.cn/4559fc4f3e0f44afa20141fb789bc232.png" alt="在这里插入图片描述"><br>安装完成后可以首先输入npm use+版本号（使用此命令行可以根据你自己的需要随意切换node.js版本运行），之后可分别输入命令行node -v和npm -v，检验node.js以及对应npm是否安装成功，如果可以显示版本号这说明安装成功。</p>
<p><img data-src="https://img-blog.csdnimg.cn/b16044d64c9046c5b9dfd75b9055fbe4.png" alt="在这里插入图片描述"></p>
<p>(4) 输入命令行nvm ls查看你安装的所有node.js版本号，以及你当前所选择的node.js运行版本</p>
<p><img data-src="https://img-blog.csdnimg.cn/7408562882904f05905f3c4548b0c42c.png" alt="在这里插入图片描述"></p>
<p>(4) 如果想删除某node.js版本的话，输入命令行nvm install node版本号（例如：nvm use 12.17.0）即可删除对应版本<br>总结：使用nvm来管理node.js的版本真的很方便，这样就可以根据自己的需要来回切换node.js版本！</p>
<h2 id="配置镜像"><a href="#配置镜像" class="headerlink" title="配置镜像"></a>配置镜像</h2><p>在 nvm 的安装路径下，找到 settings.txt，设置node_mirro与npm_mirror为国内镜像地址。下载就飞快了~~</p>
<p>root: D:\nvm<br>path: D:\nodejs<br>node_mirror: <a target="_blank" rel="noopener" href="https://npm.taobao.org/mirrors/node/">https://npm.taobao.org/mirrors/node/</a><br>npm_mirror: <a target="_blank" rel="noopener" href="https://npm.taobao.org/mirrors/npm/">https://npm.taobao.org/mirrors/npm/</a><br><img data-src="https://img-blog.csdnimg.cn/c87d180714a04b5895b7557d63cacef7.png" alt="在这里插入图片描述"></p>

      
    </div>

    
    
    
 <div>
    
  </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pistachiout.github.io/wiki/UNIX%E7%AE%80%E5%8D%95%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Pistachiout">
      <meta itemprop="description" content="Pistachiout的学习博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pistachiout的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/wiki/UNIX%E7%AE%80%E5%8D%95%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-16 18:54:55" itemprop="dateCreated datePublished" datetime="2023-02-16T18:54:55+08:00">2023-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-15 10:16:23" itemprop="dateModified" datetime="2023-02-15T10:16:23+08:00">2023-02-15</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>12k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>11 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-1设计目的和内容要求"><a href="#1-1设计目的和内容要求" class="headerlink" title="1.1设计目的和内容要求"></a>1.1设计目的和内容要求</h1><h2 id="1-设计目的"><a href="#1-设计目的" class="headerlink" title="1. 设计目的"></a>1. 设计目的</h2><p>   通过具体的文件存储空间的管理、文件的物理结构、目录结构和文件操作的实现，加深对文件系统内部数据结构、功能以及实现过程的理解。</p>
<h2 id="2．内容要求"><a href="#2．内容要求" class="headerlink" title="2．内容要求"></a>2．内容要求</h2><p>(1)在内存中开辟一个虚拟磁盘空间作为文件存储分区，在其上实现一个简单的基于多级目录的单用户单任务系统中的文件系统。在退出该文件系统的使用时，应将该虚拟文件系统以一个文件的方式保存到磁盘上，以便下次可以再将它恢复到内存的虚拟磁盘空间中。<br>(2)文件存储空间的分配可采用显式链接分配或其他的办法。<br>(3)文件目录结构采用多级目录结构。为了简单起可以通过目录项实现对文件的读和写的保护。见，可以不使用索引结点，其中的每个目录项应包含文件名、物理地址、长度等信息，还<br>(4)要求提供以下操作命令：</p>
<ul>
<li>my_format：对文件存储器进行格式化，即按照文件系统的结构对虚拟磁盘空间进行布局，并在其上创建根目录以及用于管理文件存储空间等的数据结构。</li>
<li>my_mkdir：用于创建子目录。</li>
<li>my_rmdir：用于删除子目录。</li>
<li>my_ls：用于显示目录中的内容。</li>
<li>my_cd：用于更改当前目录。</li>
<li>my_create：用于创建文件。</li>
<li>my_open：用于打开文件。</li>
<li>my_close：用于关闭文件。</li>
<li>my_write：用于写文件。</li>
<li>my_read：用于读文件。</li>
<li>my_rm：用于删除文件。</li>
<li>List item</li>
</ul>
<p>my_exitsys：用于退出文件系统。</p>
<h1 id="1-2-预备知识"><a href="#1-2-预备知识" class="headerlink" title="1.2 预备知识"></a>1.2 预备知识</h1><h2 id="1．打开文件函数open"><a href="#1．打开文件函数open" class="headerlink" title="1．打开文件函数open()"></a>1．打开文件函数open()</h2><p>（1）格式：fd&#x3D;open(name, rwmode[,pmode]);<br>（2）功能：打开一个已存在的文件。</p>
<h2 id="2．关闭文件函数close"><a href="#2．关闭文件函数close" class="headerlink" title="2．关闭文件函数close()"></a>2．关闭文件函数close()</h2><p>（1）格式：status&#x3D;close(fd);<br>（2）功能：用来关闭先前open()打开的一个文件。此动作会让缓冲区内的数据写入文件中，并释放系统所提供的文件资源。</p>
<h2 id="3．读文件函数read"><a href="#3．读文件函数read" class="headerlink" title="3．读文件函数read()"></a>3．读文件函数read()</h2><p>（1）格式：n&#x3D; read( fd,buffer,size )；<br>（2）功能：对文件的读操作。<br>（3）输入参数说明：<br>n是一次读操作的返回字节数；<br> buffer：是指向读缓冲区的指针；<br>size：  本次读文件时请求读的字节数；</p>
<h2 id="4-写文件函数write"><a href="#4-写文件函数write" class="headerlink" title="4. 写文件函数write()"></a>4. 写文件函数write()</h2><p>（1）格式：n&#x3D; write( fd,buffer,size )；<br>（2）功能：将数据写到二进制文件中。<br>（3）输入参数说明：<br>n是一次写操作的返回字节数；<br> buffer：是指向写缓冲区的指针；<br>size：  本次写文件时请求写的字节数；</p>
<h2 id="5-定位文件函数lseek"><a href="#5-定位文件函数lseek" class="headerlink" title="5. 定位文件函数lseek()"></a>5. 定位文件函数lseek()</h2><p>（1）格式：newpos&#x3D;lseek( fd, offset, origin )；<br>（2）功能： 改变文件指针所处的位置。<br>（3）输入参数说明：<br>newpos是一个长整数返回值，若lseek调用成功则返回文件指针的新位置，若调用失败则返回-1；<br> fd是被打开文件的描述符<br>offset：位移量，以字节为单位；<br>origin：初始位置，是确定文件指针偏移量的基准点，有三个常量：<br>SEEK_CUR：读写指针当前位置；<br>SEEK_SET：文件开头；<br>SEEK_END：文件末尾。</p>
<h1 id="1-3实例系统的设计与实现"><a href="#1-3实例系统的设计与实现" class="headerlink" title="1.3实例系统的设计与实现"></a>1.3实例系统的设计与实现</h1><h2 id="1-3-1-数据结构设计"><a href="#1-3-1-数据结构设计" class="headerlink" title="1.3.1 数据结构设计"></a>1.3.1 数据结构设计</h2><h2 id="1．需要包含的头文件"><a href="#1．需要包含的头文件" class="headerlink" title="1．需要包含的头文件"></a>1．需要包含的头文件</h2><p>  （1）#include &lt;stdio.h&gt;<br>（2）#include &lt;malloc.h&gt;<br>（3）#include &lt;string.h&gt;<br>（4）#include &lt;time.h&gt;</p>
<h2 id="2．定义的常量"><a href="#2．定义的常量" class="headerlink" title="2．定义的常量"></a>2．定义的常量</h2><p>（1）#define  BLOCKSIZE  1024      磁盘块大小<br>（2）#define  SIZE         1024000   虚拟磁盘空间大小<br>（3）#define  END         65535     文件结束标志<br>（4）#define  FREE        0         盘块空闲标志<br>（5）#define  ROOTBLOCKNUM  2   根目录区所占盘块总数<br>（6）#define  MAXOPENFILE    10   最多同时打开文件个数</p>
<h2 id="3．数据结构"><a href="#3．数据结构" class="headerlink" title="3．数据结构"></a>3．数据结构</h2><h2 id="（1）文件控制块FCB"><a href="#（1）文件控制块FCB" class="headerlink" title="（1）文件控制块FCB"></a>（1）文件控制块FCB</h2><p>用于记录文件的描述和控制信息，每个文件设置一个FCB，它也是文件的目录项的内容。<br>    typedef struct FCB &#x2F;&#x2F;仿照FAT16设置的<br>{<br>        char filename[8]; &#x2F;&#x2F;文件名<br>        char exname[3];&#x2F;&#x2F;文件扩展名<br>        unsigned char attribute;&#x2F;&#x2F;文件属性字段：为简单起见，我们只为文件设置了两种属性：<br>&#x2F;&#x2F;值为0时表示目录文件，值为1时表示数据文件<br>        unsigned short time;&#x2F;&#x2F;文件创建时间<br>        unsigned short data;&#x2F;&#x2F;文件创建日期<br>        unsigned short first;&#x2F;&#x2F;文件起始盘块号<br>        unsigned long length;&#x2F;&#x2F;文件长度（字节数）<br>        char free；&#x2F;&#x2F;表示目录项是否为空，若值为0，表示空，值为1，表示已分配<br>}fcb;</p>
<h2 id="（2）文件分配表FAT"><a href="#（2）文件分配表FAT" class="headerlink" title="（2）文件分配表FAT"></a>（2）文件分配表FAT</h2><p>   在本实例中，文件分配表有两个作用：一是记录磁盘上每个文件所占据的磁盘块的块号；二是记录磁盘上哪些块已经分配出去了，哪些块是空闲的，即起到了位示图的作用。若FAT中某个表项的值为FREE，则表示该表项所对应的磁盘块是空闲的；若某个表项的值为END，则表示所对应的磁盘块是某文件的最后一个磁盘块；若某个表项的值是其他值，则该值表示某文件的下一个磁盘块的块号。为了提高系统的可靠性，本实例中设置了两张FAT表，它们互为备份，每个FAT占据两个磁盘块。<br>typedef struct FAT<br>{<br>        unsigned short id;<br>}fat;</p>
<h2 id="（3）用户打开文件表USEROPEN"><a href="#（3）用户打开文件表USEROPEN" class="headerlink" title="（3）用户打开文件表USEROPEN"></a>（3）用户打开文件表USEROPEN</h2><ul>
<li>当打开一个文件时，必须将文件的目录项中的所有内容全部复制到内存中，同时还要记录有关文件操作的动态信息，如读写指针的值等。在本实例中实现的是一个用于单用户单任务系统的文件系统，为简单起见，我们把用户文件描述符表和内存FCB表合在一起，称为用户打开文件表，表项数目为10，即一个用户最多可同时打开10个文件。然后用一个数组来描述，则数组下标即某个打开文件的描述符。另外，我们在用户打开文件表中还设置了一个字段“char dir[80]”，用来记录每个打开文件所在的目录名，以方便用户打开不同目录下具有相同文件名的不同文件。<br>typedef struct USEROPEN<br>{<br> char filename[8]; &#x2F;&#x2F;文件名<br> char exname[3];&#x2F;&#x2F;文件扩展名<br> unsigned char attribute;&#x2F;&#x2F;文件属性：值为0时表示目录文件，值为1时表示数据文件<br> unsigned short time;&#x2F;&#x2F;文件创建时间<br> unsigned short data;&#x2F;&#x2F;文件创建日期<br> unsigned short first;&#x2F;&#x2F;文件起始盘块号<br> unsigned long length;&#x2F;&#x2F;文件长度（对数据文件是字节数，对目录文件可以是目录项个数）</li>
</ul>
<p>char free；&#x2F;&#x2F;表示目录项是否为空，若值为0，表示空，值为1，表示已分配<br>        &#x2F;&#x2F;前面内容是文件的FCB中的内容。<br>        &#x2F;&#x2F; 下面设置的dirno和diroff记录了相应打开文件的目录项在父目录文件中的位置，&#x2F;&#x2F;这样如果该文件的fcb被修改了，则要写回父目录文件时比较方便<br>        int dirno;  &#x2F;&#x2F;相应打开文件的目录项在父目录文件中的盘块号<br>        int diroff；&#x2F;&#x2F; 相应打开文件的目录项在父目录文件的dirno盘块中的目录项序号<br>        char dir[MAXOPENFILE][80]; &#x2F;&#x2F;相应打开文件所在的目录名，这样方便快速检查出<br>&#x2F;&#x2F;指定文件是否已经打开<br>        int count; &#x2F;&#x2F;读写指针在文件中的位置<br>        char fcbstate; &#x2F;&#x2F;是否修改了文件的FCB的内容，如果修改了置为1，否则为0<br>char topenfile; &#x2F;&#x2F;表示该用户打开表项是否为空，若值为0，表示为空，否则表示已<br>&#x2F;&#x2F;被某打开文件占据<br>}useropen;</p>
<h2 id="（4）引导块BLOCK0"><a href="#（4）引导块BLOCK0" class="headerlink" title="（4）引导块BLOCK0"></a>（4）引导块BLOCK0</h2><ul>
<li>在引导块中主要存放逻辑磁盘的相关描述信息，比如磁盘块大小、磁盘块数量、文件分配表、根目录区、数据区在磁盘上的起始位置等。如果是引导盘，还要存放操作系统的引导信息。本实例是在内存的虚拟磁盘中创建一个文件系统，因此所包含的内容比较少，只有磁盘块大小、磁盘块数量、数据区开始位置、根目录文件开始位置等。<br>typedef struct BLOCK0  &#x2F;&#x2F;引导块内容<br>{<br>&#x2F;&#x2F;存储一些描述信息，如磁盘块大小、磁盘块数量、最多打开文件数等、<br> char information[200];<br> unsigned short root; &#x2F;&#x2F;根目录文件的起始盘块号<br> unsigned char *startblock; &#x2F;&#x2F;虚拟磁盘上数据区开始位置</li>
</ul>
<p>}block0;</p>
<pre><code>4．全局变量定义
</code></pre>
<p>（1）unsigned char *myvhard： 指向虚拟磁盘的起始地址<br>（2）useropen openfilelist[MAXOPENFILE]：   用户打开文件表数组<br>（3）useropen <em>ptrcurdir： 指向用户打开文件表中的当前目录所在打开文件表项的位置；<br>（4）char currentdir[80]：     记录当前目录的目录名（包括目录的路径）<br>（5）unsigned char</em> startp：   记录虚拟磁盘上数据区开始位置</p>
<p>5．虚拟磁盘空间布局</p>
<ul>
<li>由于真正的磁盘操作需要涉及到设备的驱动程序，所以本实例是在内存中申请一块空间作为虚拟磁盘使用，我们的文件系统就建立在这个虚拟磁盘上。虚拟磁盘一共划分成1000个磁盘块，每个块1024个字节，其布局格式是模仿FAT文件系统设计的，其中引导块占一个盘块，两张FAT各占2个盘块，剩下的空间全部是数据区，在对虚拟磁盘进行格式化的时候，将把数据区第1块（即虚拟磁盘的第6块）分配给根目录文件。<br> 当然，也可以仿照FAT16文件系统，设置根目录区，其位置紧跟第2张FAT后面，大小也是固定的，这个思路相对要简单一点，请同学们自己去实现。</li>
</ul>
<h2 id="1-3-2-实例主要命令及函数设计"><a href="#1-3-2-实例主要命令及函数设计" class="headerlink" title="1.3.2 实例主要命令及函数设计"></a>1.3.2 实例主要命令及函数设计</h2><h2 id="1．系统主函数main"><a href="#1．系统主函数main" class="headerlink" title="1．系统主函数main()"></a>1．系统主函数main()</h2><p>（1）对应命令：无<br>（2）命令调用格式：无<br>（3）函数设计格式：void main()<br>（4）功能：系统主函数<br>（5）输入：无<br>（6）输出：无<br>（7）函数需完成的工作：<br>① 对前面定义的全局变量进行初始化；<br>② 调用startsys()进入文件系统；<br>③ 列出文件系统提供的各项功能及命令调用格式；<br>④ 显示命令行提示符，等待用户输入命令；<br>⑤ 将用户输入的命令保存到一个buf中；<br>⑥ 对buf中的内容进行命令解析，并调用相应的函数执行用户键入的命令；<br>⑦ 如果命令不是“my_exitsys”，则命令执行完毕后转④。</p>
<h2 id="2-进入文件系统函数startsys"><a href="#2-进入文件系统函数startsys" class="headerlink" title="2. 进入文件系统函数startsys()"></a>2. 进入文件系统函数startsys()</h2><p>（1）对应命令：无<br>（2）命令调用格式：无<br>（3）函数设计格式：void startsys()<br>（4）功能：由main()函数调用，进入并初始化我们所建立的文件系统，以供用户使用。<br>（5）输入：无  	<br>（6）输出：无。<br>（7）函数需完成的工作：<br>① 申请虚拟磁盘空间；<br>② 使用c语言的库函数fopen()打开myfsys文件：若文件存在，则转③；若文件不存在，则创建之，转⑤<br>③ 使用c语言的库函数fread()读入myfsys文件内容到用户空间中的一个缓冲区中，并判断其开始的8个字节内容是否为“10101010”（文件系统魔数），如果是，则转④；否则转⑤；<br>④ 将上述缓冲区中的内容复制到内存中的虚拟磁盘空间中；转⑦<br>⑤ 在屏幕上显示“myfsys文件系统不存在，现在开始创建文件系统”信息，并调用my_format()对①中申请到的虚拟磁盘空间进行格式化操作。转⑥；<br>⑥ 将虚拟磁盘中的内容保存到myfsys文件中；转⑦<br>⑦ 使用c语言的库函数fclose()关闭myfsys文件；<br>⑧ 初始化用户打开文件表，将表项0分配给根目录文件使用，并填写根目录文件的相关信息，由于根目录没有上级目录，所以表项中的dirno和diroff分别置为5（根目录所在起始块号）和0；并将ptrcurdir指针指向该用户打开文件表项。<br>⑨ 将当前目录设置为根目录。</p>
<h2 id="3．磁盘格式化函数my-format"><a href="#3．磁盘格式化函数my-format" class="headerlink" title="3．磁盘格式化函数my_format()"></a>3．磁盘格式化函数my_format()</h2><p>（1）对应命令：my_format<br>（2）命令调用格式：my_format<br>（3）函数设计格式：void my_format()<br>（4）功能：对虚拟磁盘进行格式化，布局虚拟磁盘，建立根目录文件（或根目录区）。<br>（5）输入：无  	<br>（6）输出：无。<br>（7）函数需完成的工作：<br>① 将虚拟磁盘第一个块作为引导块，开始的8个字节是文件系统的魔数，记为“10101010”；在之后写入文件系统的描述信息，如FAT表大小及位置、根目录大小及位置、盘块大小、盘块数量、数据区开始位置等信息；<br>② 在引导块后建立两张完全一样的FAT表，用于记录文件所占据的磁盘块及管理虚拟磁盘块的分配，每个FAT占据两个磁盘块；对于每个FAT中，前面5个块设置为已分配，后面995个块设置为空闲；<br>③ 在第二张FAT后创建根目录文件root，将数据区的第1块（即虚拟磁盘的第6块）分配给根目录文件，在该磁盘上创建两个特殊的目录项：“.”和“..”，其内容除了文件名不同之外，其他字段完全相同。 </p>
<h2 id="4．更改当前目录函数my-cd"><a href="#4．更改当前目录函数my-cd" class="headerlink" title="4．更改当前目录函数my_cd()"></a>4．更改当前目录函数my_cd()</h2><p>（1）对应命令：my_cd<br>（2）命令调用格式：my_cd dirname<br>（3）函数设计格式：void my_cd(char *dirname)<br>（4）功能：改变当前目录到指定的名为dirname的目录。<br>（5）输入：<br>dirname：新的当前目录的目录名；         	<br>（6）输出：无<br>（7）函数需完成的工作：<br>① 调用my_open()打开指定目录名的父目录文件，并调用do_read()读入该父目录文件内容到内存中；<br>② 在父目录文件中检查新的当前目录名是否存在，如果存在则转③，否则返回，并显示出错信息；<br>③ 调用my_close()关闭①中打开的父目录文件；<br>④ 调用my_close()关闭原当前目录文件；<br>⑤ 如果新的当前目录文件没有打开，则打开该目录文件；并将ptrcurdir指向该打开文件表项；<br>⑥ 设置当前目录为该目录。</p>
<h2 id="5．创建子目录函数my-mkdir"><a href="#5．创建子目录函数my-mkdir" class="headerlink" title="5．创建子目录函数my_mkdir()"></a>5．创建子目录函数my_mkdir()</h2><p>（1）对应命令：my_mkdir<br>（2）命令调用格式：my_ mkdir dirname<br>（3）函数设计格式：void my_mkdir(char *dirname)<br>（4）功能：在当前目录下创建名为dirname的子目录。<br>（5）输入：<br>dirname：新建目录的目录名。         	<br>（6）输出：无。<br>（7）函数需完成的工作：<br>① 调用do_read()读入当前目录文件内容到内存，检查当前目录下新建目录文件是否重名，若重名则返回，并显示错误信息；<br>② 为新建子目录文件分配一个空闲打开文件表项，如果没有空闲表项则返回-1，并显示错误信息；<br>③ 检查FAT是否有空闲的盘块，如有则为新建目录文件分配一个盘块，否则释放①中分配的打开文件表项，返回，并显示错误信息；<br>④ 在当前目录中为新建目录文件寻找一个空闲的目录项或为其追加一个新的目录项;需修改当前目录文件的长度信息，并将当前目录文件的用户打开文件表项中的fcbstate置为1；<br>⑤ 准备好新建目录文件的FCB的内容，文件的属性为目录文件，以覆盖写方式调用do_write()将其填写到对应的空目录项中；<br>⑥ 在新建目录文件所分配到的磁盘块中建立两个特殊的目录项“.”和“..”目录项，方法是：首先在用户空间中准备好内容，然后以截断写或者覆盖写方式调用do_write()将其写到③中分配到的磁盘块中；<br>⑦ 返回。</p>
<h2 id="6．删除子目录函数rmdir"><a href="#6．删除子目录函数rmdir" class="headerlink" title="6．删除子目录函数rmdir()"></a>6．删除子目录函数rmdir()</h2><p>（1）对应命令：my_ rmdir<br>（2）命令调用格式：my_ rmdir dirname<br>（1）函数设计格式：void my_rmdir(char *dirname)<br>（2）功能：在当前目录下删除名为dirname的子目录。<br>（3）输入：<br>dirname：欲删除目录的目录名。         	<br>（4）输出：无。<br>（5）函数需完成的工作：<br>① 调用do_read()读入当前目录文件内容到内存，检查当前目录下欲删除目录文件是否存在，若不存在则返回，并显示错误信息；<br>② 检查欲删除目录文件是否为空（除了“.”和“..”外没有其他子目录和文件），可根据其目录项中记录的文件长度来判断，若不为空则返回，并显示错误信息；<br>③ 检查该目录文件是否已经打开，若已打开则调用my_close()关闭掉；<br>④ 回收该目录文件所占据的磁盘块，修改FAT；<br>⑤ 从当前目录文件中清空该目录文件的目录项，且free字段置为0：以覆盖写方式调用do_write()来实现；<br>⑥ 修改当前目录文件的用户打开表项中的长度信息，并将表项中的fcbstate置为1；<br>⑦ 返回。</p>
<h2 id="7．显示目录函数my-ls"><a href="#7．显示目录函数my-ls" class="headerlink" title="7．显示目录函数my_ls()"></a>7．显示目录函数my_ls()</h2><p>（1）对应命令：my_ls<br>（2）命令调用格式：my_ls<br>（3）函数设计格式：void my_ls(void)<br>（4）功能：显示当前目录的内容（子目录和文件信息）。<br>（5）输入：无         	<br>（6）输出：无<br>（7）函数需完成的工作：<br>① 调用do_read()读出当前目录文件内容到内存；<br>② 将读出的目录文件的信息按照一定的格式显示到屏幕上；<br>③ 返回。  </p>
<h2 id="8．创建文件函数my-create"><a href="#8．创建文件函数my-create" class="headerlink" title="8．创建文件函数my_create()"></a>8．创建文件函数my_create()</h2><p>（1）对应命令：my_create<br>（2）命令调用格式：my_create filename<br>（3）函数设计格式：int my_create (char *filename)<br>（4）功能：创建名为filename的新文件。<br>（5）输入：<br>filename：新建文件的文件名，可能包含路径。         	<br>（6）输出：若创建成功，返回该文件的文件描述符（文件打开表中的数组下标）；否则返回-1。<br>（7）函数需完成的工作：<br>① 为新文件分配一个空闲打开文件表项，如果没有空闲表项则返回-1，并显示错误信息；<br>② 若新文件的父目录文件还没有打开，则调用my_open()打开；若打开失败，则释放①中为新建文件分配的空闲文件打开表项，返回-1，并显示错误信息；<br>③ 调用do_read()读出该父目录文件内容到内存，检查该目录下新文件是否重名，若重名则释放①中分配的打开文件表项，并调用my_close()关闭②中打开的目录文件；然后返回-1，并显示错误信息；<br>④ 检查FAT是否有空闲的盘块，如有则为新文件分配一个盘块，否则释放①中分配的打开文件表项，并调用my_close()关闭②中打开的目录文件；返回-1，并显示错误信息；<br>⑤ 在父目录中为新文件寻找一个空闲的目录项或为其追加一个新的目录项;需修改该目录文件的长度信息，并将该目录文件的用户打开文件表项中的fcbstate置为1；<br>⑥ 准备好新文件的FCB的内容，文件的属性为数据文件，长度为0，以覆盖写方式调用do_write()将其填写到⑤中分配到的空目录项中；<br>⑦ 为新文件填写①中分配到的空闲打开文件表项，fcbstate字段值为0，读写指针值为0；<br>⑧ 调用my_close()关闭②中打开的父目录文件；<br>⑨ 将新文件的打开文件表项序号作为其文件描述符返回。</p>
<h2 id="9．删除文件函数my-rm"><a href="#9．删除文件函数my-rm" class="headerlink" title="9．删除文件函数my_rm()"></a>9．删除文件函数my_rm()</h2><p>（1）对应命令：my_rm<br>（2）命令调用格式：my_rm filename<br>（3）函数设计格式：void my_rm(char *filename)<br>（4）功能：删除名为filename的文件。<br>（5）输入：<br>filename：欲删除文件的文件名，可能还包含路径。         	<br>（6）输出：无。<br>（7）函数需完成的工作：<br>① 若欲删除文件的父目录文件还没有打开，则调用my_open()打开；若打开失败，则返回，并显示错误信息；<br>② 调用do_read()读出该父目录文件内容到内存，检查该目录下欲删除文件是否存在，若不存在则返回，并显示错误信息；<br>③ 检查该文件是否已经打开，若已打开则关闭掉；<br>④ 回收该文件所占据的磁盘块，修改FAT；<br>⑤ 从文件的父目录文件中清空该文件的目录项，且free字段置为0：以覆盖写方式调用do_write()来实现；；<br>⑥ 修改该父目录文件的用户打开文件表项中的长度信息，并将该表项中的fcbstate置为1；<br>⑦ 返回。</p>
<h2 id="10．打开文件函数my-open"><a href="#10．打开文件函数my-open" class="headerlink" title="10．打开文件函数my_open()"></a>10．打开文件函数my_open()</h2><p>（1）对应命令：my_open<br>（2）命令调用格式：my_open filename<br>（3）函数设计格式：int my_open(char *filename)<br>（4）功能：打开当前目录下名为filename的文件。<br>（5）输入：<br>filename：欲打开文件的文件名         	<br>（6）输出：若打开成功，返回该文件的描述符（在用户打开文件表中表项序号）；否则返回-1。<br>（7）函数需完成的工作：<br>① 检查该文件是否已经打开，若已打开则返回-1，并显示错误信息；<br>② 调用do_read()读出父目录文件的内容到内存，检查该目录下欲打开文件是否存在，若不存在则返回-1，并显示错误信息；<br>③ 检查用户打开文件表中是否有空表项，若有则为欲打开文件分配一个空表项，若没有则返回-1，并显示错误信息；<br>④ 为该文件填写空白用户打开文件表表项内容，读写指针置为0；<br>⑤ 将该文件所分配到的空白用户打开文件表表项序号（数组下标）作为文件描述符fd返回。</p>
<h2 id="11．关闭文件函数my-close"><a href="#11．关闭文件函数my-close" class="headerlink" title="11．关闭文件函数my_close()"></a>11．关闭文件函数my_close()</h2><p>（1）对应命令：my_close<br>（2）命令调用格式：my_close fd<br>（3）函数设计格式：void my_close(int fd)<br>（4）功能：关闭前面由my_open()打开的文件描述符为fd的文件。<br>（5）输入：<br>fd：文件描述符。         	<br>（6）输出：无。<br>（7）函数需完成的工作：<br>① 检查fd的有效性（fd不能超出用户打开文件表所在数组的最大下标），如果无效则返回-1；<br>② 检查用户打开文件表表项中的fcbstate字段的值，如果为1则需要将该文件的FCB的内容保存到虚拟磁盘上该文件的目录项中，方法是：打开该文件的父目录文件，以覆盖写方式调用do_write()将欲关闭文件的FCB写入父目录文件的相应盘块中；<br>③ 回收该文件占据的用户打开文件表表项（进行清空操作），并将topenfile字段置为0；<br>④ 返回。</p>
<h2 id="12．写文件函数my-write"><a href="#12．写文件函数my-write" class="headerlink" title="12．写文件函数my_write()"></a>12．写文件函数my_write()</h2><p>（1）对应命令：my_write<br>（2）命令调用格式：my_write fd<br>（3）函数设计格式：int my_write(int fd)<br>（4）功能：将用户通过键盘输入的内容写到fd所指定的文件中。磁盘文件的读写操作都必须以完整的数据块为单位进行，在写操作时，先将数据写在缓冲区中，缓冲区的大小与磁盘块的大小相同，然后再将缓冲区中的数据一次性写到磁盘块中；读出时先将一个磁盘块中的内容读到缓冲区中，然后再传送到用户区。本实例为了简便起见，没有设置缓冲区管理，只是在读写文件时由用户使用malloc()申请一块空间作为缓冲区，读写操作结束后使用free()释放掉。<br>写操作常有三种方式：截断写、覆盖写和追加写。截断写是放弃原来文件的内容，重新写文件；覆盖写是修改文件在当前读写指针所指的位置开始的部分内容；追加写是在原文件的最后添加新的内容。在本实例中，输入写文件命令后，系统会出现提示让用户选择其中的一种写方式，并将随后键盘输入的内容按照所选的方式写到文件中，键盘输入内容通过CTR+Z键（或其他设定的键）结束。<br>（5）输入：<br>fd：  open()函数的返回值，文件的描述符；     	<br>（6）输出：实际写入的字节数。<br>（7）函数需完成的工作：<br>① 检查fd的有效性（fd不能超出用户打开文件表所在数组的最大下标），如果无效则返回-1，并显示出错信息；<br>② 提示并等待用户输入写方式：（1：截断写；2：覆盖写；3：追加写）<br>③ 如果用户要求的写方式是截断写，则释放文件除第一块外的其他磁盘空间内容（查找并修改FAT表），将内存用户打开文件表项中文件长度修改为0，将读写指针置为0并转④；如果用户要求的写方式是追加写，则修改文件的当前读写指针位置到文件的末尾，并转④；如果写方式是覆盖写，则直接转④；<br>④ 提示用户：整个输入内容通过CTR+Z键（或其他设定的键）结束；用户可分多次输入写入内容，每次用回车结束；<br>⑤ 等待用户从键盘输入文件内容，并将用户的本次输入内容保存到一临时变量text[]中，要求每次输入以回车结束，全部结束用CTR+Z键（或其他设定的键）；<br>⑥ 调用do_write()函数将通过键盘键入的内容写到文件中。<br>⑦ 如果do_write()函数的返回值为非负值，则将实际写入字节数增加do_write()函数返回值，否则显示出错信息，并转⑨；<br>⑧ 如果text[]中最后一个字符不是结束字符CTR+Z，则转⑦继续进行写操作；否则转⑨；<br>⑨ 如果当前读写指针位置大于用户打开文件表项中的文件长度，则修改打开文件表项中的文件长度信息，并将fcbstate置1；<br>⑩ 返回实际写入的字节数。</p>
<h2 id="13．实际写文件函数do-write"><a href="#13．实际写文件函数do-write" class="headerlink" title="13．实际写文件函数do_write()"></a>13．实际写文件函数do_write()</h2><p>（1）对应命令：无<br>（2）命令调用格式：无<br>（3）函数设计格式：int my_write(int fd，char *text，int len，char wstyle)<br>（4）功能：被写文件函数my_write()调用，用来将键盘输入的内容写到相应的文件中去。<br>（5）输入：<br>fd：  open()函数的返回值，文件的描述符；<br>text：指向要写入的内容的指针；<br>len：本次要求写入字节数    	<br>wstyle：写方式<br>（6）输出：实际写入的字节数。<br>（7）函数需完成的工作：<br>① 用malloc()申请1024B的内存空间作为读写磁盘的缓冲区buf，申请失败则返回-1，并显示出错信息；<br>② 将读写指针转化为逻辑块块号和块内偏移off，并利用打开文件表表项中的首块号及FAT表的相关内容将逻辑块块号转换成对应的磁盘块块号blkno；如果找不到对应的磁盘块，则需要检索FAT为该逻辑块分配一新的磁盘块，并将对应的磁盘块块号blkno登记到FAT中，若分配失败，则返回-1，并显示出错信息；<br>③ 如果是覆盖写，或者如果当前读写指针所对应的块内偏移off不等于0，则将块号为blkno的虚拟磁盘块全部1024B的内容读到缓冲区buf中；否则便用ASCII码0清空buf；<br>④ 将text中未写入的内容暂存到缓冲区buff的第off字节开始的位置，直到缓冲区满，或者接收到结束字符CTR+Z为止；将本次写入字节数记录到tmplen中；<br>⑤ 将buf中1024B的内容写入到块号为blkno的虚拟磁盘块中；<br>⑥将当前读写指针修改为原来的值加上tmplen；并将本次实际写入的字节数增加tmplen；<br>⑦ 如果tmplen小于len，则转②继续写入；否则转⑧；<br>⑧ 返回本次实际写入的字节数。</p>
<h2 id="14．读文件函数my-read"><a href="#14．读文件函数my-read" class="headerlink" title="14．读文件函数my_read()"></a>14．读文件函数my_read()</h2><p>（1）对应命令：my_read<br>（2）命令调用格式：my_read fd len<br>（3）函数设计格式：int myread (int fd, int len)<br>（4）功能：读出指定文件中从读写指针开始的长度为len的内容到用户空间中。<br>（5）输入：<br>fd：  open()函数的返回值，文件的描述符；<br>len:   要从文件中读出的字节数。       	<br>（6）输出：实际读出的字节数。<br>（7）函数需完成的工作：<br>① 定义一个字符型数组text[len]，用来接收用户从文件中读出的文件内容；<br>② 检查fd的有效性（fd不能超出用户打开文件表所在数组的最大下标），如果无效则返回-1，并显示出错信息；<br>③ 调用do_read()将指定文件中的len字节内容读出到text[]中；<br>④ 如果do_read()的返回值为负，则显示出错信息；否则将text[]中的内容显示到屏幕上；<br>⑤ 返回。</p>
<h2 id="15．实际读文件函数do-read"><a href="#15．实际读文件函数do-read" class="headerlink" title="15．实际读文件函数do_read()"></a>15．实际读文件函数do_read()</h2><p>（1）对应命令：无<br>（2）命令调用格式：无<br>（3）函数设计格式：int do_read (int fd, int len,char *text)<br>（4）功能：被my_read()调用，读出指定文件中从读写指针开始的长度为len的内容到用户空间的text中。<br>（5）输入：<br>fd：  open()函数的返回值，文件的描述符；<br>len:   要求从文件中读出的字节数。       	<br>text：指向存放读出数据的用户区地址<br>（6）输出：实际读出的字节数。<br>（7）函数需完成的工作：<br>① 使用malloc()申请1024B空间作为缓冲区buf，申请失败则返回-1，并显示出错信息；<br>② 将读写指针转化为逻辑块块号及块内偏移量off，利用打开文件表表项中的首块号查找FAT表，找到该逻辑块所在的磁盘块块号；将该磁盘块块号转化为虚拟磁盘上的内存位置；<br>③ 将该内存位置开始的1024B（一个磁盘块）内容读入buf中；<br>④ 比较buf中从偏移量off开始的剩余字节数是否大于等于应读写的字节数len，如果是，则将从off开始的buf中的len长度的内容读入到text[]中；否则，将从off开始的buf中的剩余内容读入到text[]中；<br>⑤ 将读写指针增加④中已读字节数，将应读写的字节数len减去④中已读字节数，若len大于0，则转②；否则转⑥；<br>⑥ 使用free()释放①中申请的buf。<br>⑦ 返回实际读出的字节数。</p>
<h2 id="16-退出文件系统函数my-exitsys"><a href="#16-退出文件系统函数my-exitsys" class="headerlink" title="16. 退出文件系统函数my_exitsys()"></a>16. 退出文件系统函数my_exitsys()</h2><p>（1）对应命令：my_exitsys<br>（2）命令调用格式：my_ exitsys<br>（1）函数设计格式：void my_exitsys()<br>（2）功能：退出文件系统。<br>（3）输入：无  	<br>（4）输出：无。<br>（5）函数需完成的工作：<br>① 使用C库函数fopen()打开磁盘上的myfsys文件；<br>② 将虚拟磁盘空间中的所有内容保存到磁盘上的myfsys文件中；<br>③ 使用c语言的库函数fclose()关闭myfsys文件；<br>④ 撤销用户打开文件表，释放其内存空间<br>⑤ 释放虚拟磁盘空间。</p>
<h1 id="github代码地址"><a href="#github代码地址" class="headerlink" title="github代码地址"></a>github代码地址</h1><p><a target="_blank" rel="noopener" href="https://github.com/1105358600/LunixFileSystem">https://github.com/1105358600/LunixFileSystem</a></p>

      
    </div>

    
    
    
 <div>
    
  </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pistachiout.github.io/wiki/Ubuntu%E7%BC%96%E5%88%B6%E6%A8%A1%E6%8B%9F%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E5%AD%90%E7%B3%BB%E7%BB%9F%EF%BC%8C%E7%94%B1%E8%BF%9B%E7%A8%8B%E5%BB%BA%E7%AB%8B%E6%A8%A1%E5%9D%97%E3%80%81%E8%BF%9B%E7%A8%8B%E6%92%A4%E6%B6%88%E6%A8%A1%E5%9D%97%E3%80%81%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%A1%A8%E7%BB%84%E6%88%90%EF%BC%8C%E5%B9%B6%E5%8C%85%E6%8B%AC%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2%E5%92%8C%E8%B0%83%E5%BA%A6%E6%A8%A1%E5%9D%97%20-%20%E5%89%AF%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Pistachiout">
      <meta itemprop="description" content="Pistachiout的学习博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pistachiout的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/wiki/Ubuntu%E7%BC%96%E5%88%B6%E6%A8%A1%E6%8B%9F%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86%E5%AD%90%E7%B3%BB%E7%BB%9F%EF%BC%8C%E7%94%B1%E8%BF%9B%E7%A8%8B%E5%BB%BA%E7%AB%8B%E6%A8%A1%E5%9D%97%E3%80%81%E8%BF%9B%E7%A8%8B%E6%92%A4%E6%B6%88%E6%A8%A1%E5%9D%97%E3%80%81%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%A1%A8%E7%BB%84%E6%88%90%EF%BC%8C%E5%B9%B6%E5%8C%85%E6%8B%AC%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2%E5%92%8C%E8%B0%83%E5%BA%A6%E6%A8%A1%E5%9D%97%20-%20%E5%89%AF%E6%9C%AC/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-16 18:54:55" itemprop="dateCreated datePublished" datetime="2023-02-16T18:54:55+08:00">2023-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-15 10:16:35" itemprop="dateModified" datetime="2023-02-15T10:16:35+08:00">2023-02-15</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一、进程管理子系统"><a href="#一、进程管理子系统" class="headerlink" title="一、进程管理子系统"></a>一、进程管理子系统</h1><h2 id="在Ubuntu下编制一个程序，模拟实现一个简单的进程管理子系统，它由进程建立模块、进程撤消模块、进程控制表组成，并包括进程切换和调度模块。"><a href="#在Ubuntu下编制一个程序，模拟实现一个简单的进程管理子系统，它由进程建立模块、进程撤消模块、进程控制表组成，并包括进程切换和调度模块。" class="headerlink" title="在Ubuntu下编制一个程序，模拟实现一个简单的进程管理子系统，它由进程建立模块、进程撤消模块、进程控制表组成，并包括进程切换和调度模块。"></a>在Ubuntu下编制一个程序，模拟实现一个简单的进程管理子系统，它由进程建立模块、进程撤消模块、进程控制表组成，并包括进程切换和调度模块。</h2><ol>
<li>【设计要求1】<br>该子系统接收新进程建立请求的方式是循环显示“请输入新命令行”，然后根据用户键入内容启动相应进程，其后不等待子进程结束，马上显示下一个“请输入新命令行”如此循环往复。<br>当建立进程时，相应读写进程控制表，然后借助底层环境OS中象fork和exec这样的函数将新进程投入运行（这与底层环境的实际OS不同，实际OS将新进程投入运行时要布置现场，最后时程序技术器寄存器）。进程撤消时，利用底层OS的wait( )从子进程回到本子系统，相应修改PCB。<br>比较该子系统与实际系统中的相应功能的异同与差距，尤其在现场保存与恢复方面的比较。</li>
<li>【设计要求2】<br>在上题的基础上，进一步模拟实现进程切换。希望能实现时间片满或接到sleep调用（或信号时）进行进程切换（选择其一即可）。<br>若要实现时间片，假设时间片为1秒钟，设定底层环境OS每个1秒向该系统发一个信号，本子系统将本子系统的进程切换和调度模块设定为该信号的处理程序。或者每当接到子进程发出的的sleep调用（或信号）时进行进程切换，这里子进程发出的sleep调用（或信号）代表实际系统中可能发生的sleep( )调用、等待某一时间发生等情况，进程调度采用简单的FIFO算法。</li>
<li>【设计要求3】<br>编制一个进程调度算法模块。进程调度是处理机管理的核心内容。本设计要求用编写和调试一个简单的进程调度程序。通过设计本项目可以加深理解有关进程控制块、进程队列的概念，并体会和了解最高优先数优先的调度算法（即把处理机分配给优先数最高的进程）和先来先服务算法的具体实施办法。<br>(1) 进程调度算法：采用最高优先数优先的调度算法（即把处理机分配给优先数最高的进程）和先来先服务算法。<br> (2) 每个进程有一个进程控制块（PCB）表示。进程控制块可以包含如下信息：进程名、优先数、到达时间、需要运行时间、已用CPU时间、进程状态等等。<br>(3) 进程的优先数及需要的运行时间可以事先人为地指定（也可以由随机数产生）。进程的到达时间为进程输入的时间。进程的运行时间以时间片为单位进行计算。<br>(4) 每个进程的状态可以是就绪W（Wait）、运行R（Run）、或完成F（Finish）三种状态之一。<br>(5) 就绪进程获得CPU后都只能运行一个时间片。用已占用CPU时间加1来表示。如果运行一个时间片后，进程的已占用CPU时间已达到所需要的运行时间，则撤消该进程，如果运行一个时间片后进程的已占用CPU时间还未达所需要的运行时间，也就是进程还需要继续运行，此时应将进程的优先数减1（即降低一级），然后把它插入就绪队列等待CPU。<br>(6) 每进行一次调度程序都打印一次运行进程、就绪队列、以及各个进程的PCB，以便进行检查。<br>(7) 重复以上过程，直到所要进程都完成为止。</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//进程类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">pcb</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="comment">//构造函数</span></span><br><span class="line">	<span class="built_in">pcb</span>(<span class="type">char</span> Name[<span class="number">20</span>], <span class="type">int</span> Rank, <span class="type">int</span> Needtime)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">strcpy</span>(name, Name);</span><br><span class="line">		state = <span class="string">&quot;Wait&quot;</span>;</span><br><span class="line">		rank = Rank;</span><br><span class="line">		needtime = Needtime;</span><br><span class="line">		runtime = <span class="number">0</span>;</span><br><span class="line">		next = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">char</span> name[<span class="number">20</span>];</span><br><span class="line">	string state;</span><br><span class="line">	<span class="type">int</span> rank;</span><br><span class="line">	<span class="type">int</span> needtime;</span><br><span class="line">	<span class="type">int</span> runtime;</span><br><span class="line">	pcb* next;</span><br><span class="line">&#125;;</span><br><span class="line">pcb *ready = <span class="literal">NULL</span>, *now = <span class="literal">NULL</span>;</span><br><span class="line"><span class="comment">//输出进程</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">output</span><span class="params">(pcb *point)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;.............................................................................&quot;</span>;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;\n 进程名称 \t 进程状态 \t   优先级 \t  所需时间 \t  已运行时间&quot;</span> &lt;&lt; endl;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;|   &quot;</span> &lt;&lt; point-&gt;name ;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;      |       &quot;</span> &lt;&lt; point-&gt;state ;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;      |        &quot;</span> &lt;&lt; point-&gt;rank ;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;      |        &quot;</span> &lt;&lt; point-&gt;needtime;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;      |        &quot;</span> &lt;&lt; point-&gt;runtime  &lt;&lt; endl;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;.............................................................................&quot;</span> &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//进程依次排序</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sort</span><span class="params">(pcb *point)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (ready == <span class="literal">NULL</span>)<span class="comment">//若链表为空</span></span><br><span class="line">	&#123;</span><br><span class="line">		ready = point;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		pcb *point1 = ready, *point2 = ready-&gt;next;</span><br><span class="line">		<span class="keyword">if</span> (point-&gt;rank &gt; point1-&gt;rank)<span class="comment">//若为优先等级最高，放在队首</span></span><br><span class="line">		&#123;</span><br><span class="line">			point-&gt;next = ready;</span><br><span class="line">			ready = point;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">while</span> (point2 != <span class="literal">NULL</span>)<span class="comment">//遍历链表，直到找到合适位置</span></span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">if</span> (point-&gt;rank &gt; point2-&gt;rank)</span><br><span class="line">				&#123;</span><br><span class="line">					point1-&gt;next = point;</span><br><span class="line">					point-&gt;next = point2;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				point1 = point2;</span><br><span class="line">				point2 = point2-&gt;next;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (point2 == <span class="literal">NULL</span>)<span class="comment">//若为优先等级最低，放在队尾</span></span><br><span class="line">			&#123;</span><br><span class="line">				point1-&gt;next = point;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//进程结束函数，打印已完成进程，释放内存</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">finish</span><span class="params">(pcb *point)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	point-&gt;state = <span class="string">&quot;Finish&quot;</span>;</span><br><span class="line"></span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;******************************** 进程&quot;</span> &lt;&lt; point-&gt;name &lt;&lt; <span class="string">&quot;已经完成 ********************************&quot;</span> &lt;&lt; endl;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;\n 进程名称 \t 进程状态 \t   优先级 \t  所需时间 \t  已运行时间&quot;</span> &lt;&lt; endl;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;|   &quot;</span> &lt;&lt; point-&gt;name ;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;      |       &quot;</span> &lt;&lt; point-&gt;state ;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;    |       &quot;</span> &lt;&lt; point-&gt;rank ;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;      |        &quot;</span> &lt;&lt; point-&gt;needtime;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;       |        &quot;</span> &lt;&lt; point-&gt;runtime  &lt;&lt; endl;</span><br><span class="line">	<span class="built_in">delete</span>(point);</span><br><span class="line">	point = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//运行一个单位时间</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">running</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	now = ready;</span><br><span class="line">	ready = ready-&gt;next;</span><br><span class="line">	now-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">	now-&gt;state = <span class="string">&quot;Run&quot;</span>;</span><br><span class="line">	now-&gt;rank--;</span><br><span class="line">	now-&gt;runtime++;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (now-&gt;needtime == now-&gt;runtime)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//若当前进程执行完毕</span></span><br><span class="line">		<span class="built_in">finish</span>(now);</span><br><span class="line">		now = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//若当前进程没有执行完毕</span></span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;***************************  当前正在运行的进程是 *************************** &quot;</span> &lt;&lt; endl;</span><br><span class="line">		<span class="built_in">output</span>(now);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//打印就绪队列</span></span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;***************************  当前就绪队列状态为 *************************** &quot;</span> &lt;&lt; endl;</span><br><span class="line">	pcb *point = ready;</span><br><span class="line">	<span class="keyword">while</span> (point != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">output</span>(point);</span><br><span class="line">		point = point-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//把没执行完的进程重新放入队列</span></span><br><span class="line">	<span class="keyword">if</span> (now != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		now-&gt;state = <span class="string">&quot;Wait&quot;</span>;</span><br><span class="line">		<span class="built_in">sort</span>(now);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//freopen(&quot;in.txt&quot;, &quot;r&quot;, stdin);</span></span><br><span class="line">	<span class="type">int</span> t;</span><br><span class="line">	cout&lt;&lt;<span class="string">&quot;**** 输入进程数目：&quot;</span>;</span><br><span class="line">	cin &gt;&gt; t;</span><br><span class="line">	cout &lt;&lt; endl;</span><br><span class="line">	<span class="comment">//进程信息输入</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= t; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		pcb *temp;</span><br><span class="line">		<span class="type">char</span> name[<span class="number">20</span>];<span class="type">int</span> rank;<span class="type">int</span> needtime;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;**** 请输入第&quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot;个进程的信息 ****&quot;</span> &lt;&lt; endl;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;请输入该进程的名字：&quot;</span>;</span><br><span class="line">		cin &gt;&gt; name;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;请输入该进程的优先等级:&quot;</span>;</span><br><span class="line">		cin &gt;&gt; rank;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;请输入该进程需要的运行时间:&quot;</span>;</span><br><span class="line">		cin &gt;&gt; needtime;</span><br><span class="line">		temp = <span class="keyword">new</span> <span class="built_in">pcb</span>(name, rank, needtime);</span><br><span class="line">		<span class="built_in">sort</span>(temp);</span><br><span class="line">		temp = <span class="literal">NULL</span>;</span><br><span class="line">		cout &lt;&lt; endl;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//打印执行前的就绪队列</span></span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;*************************** 执行前就绪队列排序 *****************************&quot;</span> &lt;&lt; endl;</span><br><span class="line">	pcb *point = ready;</span><br><span class="line">	<span class="keyword">while</span> (point != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">output</span>(point);</span><br><span class="line">		point = point-&gt;next;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;*************************** 程序准备正式开始执行 *****************************&quot;</span> &lt;&lt; endl;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//程序开始执行</span></span><br><span class="line">	<span class="type">char</span> ch;</span><br><span class="line">	<span class="keyword">while</span> (now != <span class="literal">NULL</span> || ready != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//一次运行一个单位时间</span></span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;\n\n 按任一键继续......&quot;</span> &lt;&lt; endl;</span><br><span class="line">		ch = <span class="built_in">getchar</span>();</span><br><span class="line">		<span class="built_in">running</span>();</span><br><span class="line">		cout &lt;&lt; endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//所有进程完成</span></span><br><span class="line"></span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;*************************** 所有进程均已执行完成 ***************************&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="二、进程管理子系统截图"><a href="#二、进程管理子系统截图" class="headerlink" title="二、进程管理子系统截图"></a>二、进程管理子系统截图</h2><p><img data-src="https://img-blog.csdnimg.cn/20210531231507881.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img data-src="https://img-blog.csdnimg.cn/20210531231230583.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210531231254819.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210531231258747.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210531231303604.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210531231307143.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img data-src="https://img-blog.csdnimg.cn/20210531231333261.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210531231344130.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210531231347522.png" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210531231350452.png" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210531231536537.png" alt="在这里插入图片描述"></p>

      
    </div>

    
    
    
 <div>
    
  </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pistachiout.github.io/wiki/%E5%9F%BA%E4%BA%8Essm%E7%9A%84%E5%9C%A8%E7%BA%BF%E6%8F%90%E9%97%AE%E3%80%81%E5%9B%9E%E7%AD%94%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Pistachiout">
      <meta itemprop="description" content="Pistachiout的学习博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pistachiout的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/wiki/%E5%9F%BA%E4%BA%8Essm%E7%9A%84%E5%9C%A8%E7%BA%BF%E6%8F%90%E9%97%AE%E3%80%81%E5%9B%9E%E7%AD%94%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-16 18:54:55" itemprop="dateCreated datePublished" datetime="2023-02-16T18:54:55+08:00">2023-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-15 10:17:35" itemprop="dateModified" datetime="2023-02-15T10:17:35+08:00">2023-02-15</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>296</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="名称：在线提问、回答系统"><a href="#名称：在线提问、回答系统" class="headerlink" title="名称：在线提问、回答系统"></a>名称：在线提问、回答系统</h1><h1 id="功能要求："><a href="#功能要求：" class="headerlink" title="功能要求："></a>功能要求：</h1><ol>
<li>非登陆用户可以看其他人的问答，按最后一个回答时间的倒序排列</li>
<li>登陆用户可以发布、终结自己的问题。</li>
<li>对于未终结的问题，登陆用户可以发布、修改、删除自己的回答。</li>
<li>不分板块。</li>
<li>普通人可申请注册，管理员同意后算作注册成功；管理员可将现有用户拉黑，管理员不能删除用户。</li>
<li>被拉黑用户的问题、回答对其他人不可见。</li>
<li>管理员可以屏蔽掉某个问题或者回答，也可取消屏蔽。</li>
<li>被屏蔽的问题或回答对其他人不可见；提问人或回答人自己可见。</li>
<li>被屏蔽的问题或者回答，提问人或回答人不能改、删。</li>
</ol>
<h2 id="用例图："><a href="#用例图：" class="headerlink" title="用例图："></a>用例图：<img data-src="https://img-blog.csdnimg.cn/20210608225845732.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></h2><h2 id="OOA类图："><a href="#OOA类图：" class="headerlink" title="OOA类图："></a>OOA类图：</h2><p><img data-src="https://img-blog.csdnimg.cn/20210608225909749.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/2021060923190587.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210609231945612.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210609232018563.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210609232054902.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210609232155372.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210609232237334.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210609232246421.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="源代码："><a href="#源代码：" class="headerlink" title="源代码："></a>源代码：</h2><p><a target="_blank" rel="noopener" href="https://github.com/1105358600/Qusetion_Answer">https://github.com/1105358600/Qusetion_Answer</a></p>

      
    </div>

    
    
    
 <div>
    
  </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pistachiout.github.io/wiki/%E5%9F%BA%E4%BA%8ESSM%E6%A1%86%E6%9E%B6%E7%9A%84%E7%BD%91%E4%B8%8A%E8%B4%AD%E7%89%A9%E9%80%81%E8%B4%A7%E7%B3%BB%E7%BB%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Pistachiout">
      <meta itemprop="description" content="Pistachiout的学习博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pistachiout的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/wiki/%E5%9F%BA%E4%BA%8ESSM%E6%A1%86%E6%9E%B6%E7%9A%84%E7%BD%91%E4%B8%8A%E8%B4%AD%E7%89%A9%E9%80%81%E8%B4%A7%E7%B3%BB%E7%BB%9F/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-16 18:54:55" itemprop="dateCreated datePublished" datetime="2023-02-16T18:54:55+08:00">2023-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-15 10:17:46" itemprop="dateModified" datetime="2023-02-15T10:17:46+08:00">2023-02-15</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="基于SSM框架的网上购物送货系统"><a href="#基于SSM框架的网上购物送货系统" class="headerlink" title="基于SSM框架的网上购物送货系统"></a>基于SSM框架的网上购物送货系统</h1><p>系统开发平台：Tomcat8.0 + JDK1.8 + Windows10</p>
<p>开发语言：JavaEE</p>
<p>JAR包管理：Maven3.6.1</p>
<p>前端：jQuery html5&#x2F;css3</p>
<p>后台</p>
<p>核心架构：SpringBoot</p>
<p>Web框架：SpringMVC</p>
<p>持久层框架：Mybatis</p>
<p>模板引擎：Thymeleaf</p>
<p>数据库：Mysql</p>
<h1 id="1-系统参与角色：管理者、购物者、送货员。"><a href="#1-系统参与角色：管理者、购物者、送货员。" class="headerlink" title="1.系统参与角色：管理者、购物者、送货员。"></a>1.系统参与角色：管理者、购物者、送货员。</h1><ol>
<li>管理者：负责管理商品，提供商品信息，处理订单事务，系统的日常维护，控制超市状态。   </li>
<li>购物者：在线注册账户，更新个人信息，管理账户，搜索浏览商品，管理购物车，支付订单，申请退款，留言以及售后评价。</li>
<li>送货员：注册成为送货员，更新个人信息，查看订单信息。</li>
</ol>
<h1 id="2-系统应用场景"><a href="#2-系统应用场景" class="headerlink" title="2.系统应用场景"></a>2.系统应用场景</h1><ol>
<li>活动泳道图之管理者<br>在现实应用中，管理员可以通过管理员界面进行登录，然后管理商品，账号等信息。也可以设置超市公告，查看销售情况和订单信息等<br><img data-src="https://img-blog.csdnimg.cn/2021060818403134.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.活动泳道图之购物者<br>在现实应用中，购物者可以通过顾客界面进行登录，然后查看商品并对其进行各项操作，包括加入购物车和购买支付等，也可以管理自身信息，留言<br><img data-src="https://img-blog.csdnimg.cn/20210608184128986.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>3.活动泳道图之送货员<br>在现实应用中，送货员可以通过送货员界面进行登录，然后管理自身信息，也可以查看订单信息并操作<br><img data-src="https://img-blog.csdnimg.cn/20210608184148729.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></li>
</ol>
<h1 id="3-1需求模型"><a href="#3-1需求模型" class="headerlink" title="3.1需求模型"></a>3.1需求模型</h1><p>1.购物者业务流程图<br><img data-src="https://img-blog.csdnimg.cn/20210608184235672.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>2.管理员业务流程图<br><img data-src="https://img-blog.csdnimg.cn/20210608184255367.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>3.送货员业务流程图<br><img data-src="https://img-blog.csdnimg.cn/20210608184319379.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>4.订单管理业务流程图<img data-src="https://img-blog.csdnimg.cn/20210608184331814.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="3-2功能模型"><a href="#3-2功能模型" class="headerlink" title="3.2功能模型"></a>3.2功能模型</h1><p><img data-src="https://img-blog.csdnimg.cn/20210608184355428.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="3-3用例模型"><a href="#3-3用例模型" class="headerlink" title="3.3用例模型"></a>3.3用例模型</h1><p><img data-src="https://img-blog.csdnimg.cn/20210608184415142.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="管理员用例图"><br><img data-src="https://img-blog.csdnimg.cn/20210608184428959.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="用户用例图"></p>
<h1 id="4-系统截图"><a href="#4-系统截图" class="headerlink" title="4.系统截图"></a>4.系统截图</h1><h2 id="用户页面"><a href="#用户页面" class="headerlink" title="用户页面"></a>用户页面</h2><p><img data-src="https://img-blog.csdnimg.cn/20210608184503797.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210608184510432.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img data-src="https://img-blog.csdnimg.cn/20210608184524871.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img data-src="https://img-blog.csdnimg.cn/20210608184536654.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p><img data-src="https://img-blog.csdnimg.cn/20210608184547955.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="送货员页面"><a href="#送货员页面" class="headerlink" title="送货员页面"></a>送货员页面</h2><p><img data-src="https://img-blog.csdnimg.cn/20210608184554927.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="管理员页面"><a href="#管理员页面" class="headerlink" title="管理员页面"></a>管理员页面</h2><p><img data-src="https://img-blog.csdnimg.cn/20210608184602245.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210608184655151.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210608184703440.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210608184707731.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210608184713690.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/2021060818471891.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="5-难点实现"><a href="#5-难点实现" class="headerlink" title="5.难点实现"></a>5.难点实现</h1><h2 id="2-支付宝支付实现"><a href="#2-支付宝支付实现" class="headerlink" title="2.支付宝支付实现"></a>2.支付宝支付实现</h2><p><img data-src="https://img-blog.csdnimg.cn/20210608184909336.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210608184919841.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>!<img data-src="https://img-blog.csdnimg.cn/20210608184954909.png" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210608184959606.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/2021060818500414.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210608185009984.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="2-服务器的搭建"><a href="#2-服务器的搭建" class="headerlink" title="2.服务器的搭建"></a>2.服务器的搭建</h2><p>服务器搭建教程：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35206244/article/details/83184173">https://blog.csdn.net/qq_35206244&#x2F;article&#x2F;details&#x2F;83184173</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/Aidiying/article/details/84442638">https://blog.csdn.net/Aidiying/article/details/84442638</a><br>为了实现用户的远程操作，我们把项目部署到了云服务器上，云服务器可以节省经济成本，又节约了大量时间。我们项目用的是腾讯云服务器。<br><img data-src="https://img-blog.csdnimg.cn/20210608185540462.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210608185544291.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/20210608185559940.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="3-销量图表"><a href="#3-销量图表" class="headerlink" title="3.销量图表"></a>3.销量图表</h2><p>为了方便管理员进货，我们利用图表来帮助管理员了解商城销售商品的数量以及占比，利用ECharts来将后台的销量数据可视化，以便于直观显示销量占比<br><img data-src="https://img-blog.csdnimg.cn/20210608185345574.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="4-订单号设置随机数保证一定的并发性"><a href="#4-订单号设置随机数保证一定的并发性" class="headerlink" title="4.订单号设置随机数保证一定的并发性"></a>4.订单号设置随机数保证一定的并发性</h2><p>在购物时，会根据购物时间来生成订单号，为了避免多人同时购买商品时订单号重复使系统出现问题，我们利用ordernum++来生成不重复的订单号，保证一定程度的并发性。<br><img data-src="https://img-blog.csdnimg.cn/20210608185451284.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="5-定时调用轮转实现图片轮换"><a href="#5-定时调用轮转实现图片轮换" class="headerlink" title="5.定时调用轮转实现图片轮换"></a>5.定时调用轮转实现图片轮换</h2><p><img data-src="https://img-blog.csdnimg.cn/20210608185210643.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="1.在jsp中创建容器用来存放图片
2.在css中设置相关的样式
3.js中的相关代码
 1）从后台获取图片的地址
 2）设置图片的轮转
 3）轮转的具体实现
4.定时调用轮转方法
"></p>
<h2 id="6-按序排列"><a href="#6-按序排列" class="headerlink" title="6.按序排列"></a>6.按序排列</h2><p><img data-src="https://img-blog.csdnimg.cn/20210608185314220.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="定义一个对象数组
定义一个比较器--降序排列
对象数组 按照某个属性 降序排列
"></p>
<h1 id="6-源码地址："><a href="#6-源码地址：" class="headerlink" title="6.源码地址："></a>6.源码地址：</h1><p><a target="_blank" rel="noopener" href="https://github.com/1105358600/MailSystem">https://github.com/1105358600/MailSystem</a></p>

      
    </div>

    
    
    
 <div>
    
  </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pistachiout.github.io/wiki/Shiro%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Pistachiout">
      <meta itemprop="description" content="Pistachiout的学习博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pistachiout的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/wiki/Shiro%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-16 18:54:55" itemprop="dateCreated datePublished" datetime="2023-02-16T18:54:55+08:00">2023-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-15 10:18:01" itemprop="dateModified" datetime="2023-02-15T10:18:01+08:00">2023-02-15</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Shiro"><a href="#1-Shiro" class="headerlink" title="1.Shiro"></a>1.<a target="_blank" rel="noopener" href="http://shiro.apache.org/">Shiro</a></h1><p>Shiro 是一款主流的 Java 安全框架，它不依赖任何容器，可以独立运行在 Java SE 和 Java EE 项目中，它的主要作用是对访问系统的用户进行身份认证（身份认证也就是登录）、授权、会话管理、加密等操作,用来解决安全管理的系统化框架。</p>
<h1 id="2-Shiro-核心组件"><a href="#2-Shiro-核心组件" class="headerlink" title="2.Shiro 核心组件"></a>2.Shiro 核心组件</h1><p>权限安全管理 在一个系统中是必不可少的部分，也是决定系统安全质量的关键所在，一个系统的强大全靠权限安全模块支撑。<br>说起权限，之不难想到 RBAC（Role-Based Access Control，基于角色的访问控制） 这个权限模型，权限就是功能的意思，而 RBAC 简单的说就是由 用户、角色、权限 组成的，一个用户可以拥有若干角色，每一个角色也可以拥有若干权限，给用户赋予角色，给角色赋予权限。在这种模型中，用户与角色之间，角色与权限之间，一般都是多对多的关系。</p>
<p>1、UsernamePasswordToken，Shiro 用来封装用户登录信息，使用用户的登录信息来创建令牌 Token。</p>
<p>2、SecurityManager，Shiro 的核心部分，负责安全认证和授权。</p>
<p>3、Subject，Shiro 的一个抽象概念，包含了用户信息。</p>
<p>4、Realm，开发者自定义的模块，根据项目的需求，验证和授权的逻辑全部写在 Realm 中。</p>
<p>5、AuthenticationInfo，用户的角色信息集合，认证时使用。</p>
<p>6、AuthorzationInfo，角色的权限信息集合，授权时使用。</p>
<p>7、DefaultWebSecurityManager，安全管理器，开发者自定义的 Realm 需要注入到 DefaultWebSecurityManager 进行管理才能生效。</p>
<p>8、ShiroFilterFactoryBean，过滤器工厂，Shiro 的基本运行机制是开发者定制规则，Shiro 去执行，具体的执行操作就是由 ShiroFilterFactoryBean 创建的一个个 Filter 对象来完成。</p>
<p><img data-src="https://img-blog.csdnimg.cn/20210616210617578.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h1 id="3-Spring-Boot-整合-Shiro"><a href="#3-Spring-Boot-整合-Shiro" class="headerlink" title="3.Spring Boot 整合 Shiro"></a>3.Spring Boot 整合 Shiro</h1><p>编写认证和授权规则：</p>
<ol>
<li><p>认证过滤器</p>
<p> anon：无需认证。</p>
<p> authc：必须认证。</p>
<p> authcBasic：需要通过 HTTPBasic 认证。</p>
<p> user：不一定通过认证，只要曾经被 Shiro 记录即可，比如：记住我。</p>
</li>
<li><p>授权过滤器</p>
<p> perms：必须拥有某个权限才能访问。</p>
<p> role：必须拥有某个角色才能访问。</p>
<p> port：请求的端口必须是指定值才可以。</p>
<p> rest：请求必须基于 RESTful，POST、PUT、GET、DELETE。</p>
<p> ssl：必须是安全的 URL 请求，协议 HTTPS。</p>
</li>
</ol>
<p>  创建 3 个页面，main.html、manage.html、administrator.html，访问权限如下：</p>
<blockquote>
<p>1、必须登录才能访问 main.html<br> 2、当前用户必须拥有 manage 授权才能访问 manage.html<br>  3、当前用户必须拥有 administrator 角色才能访问 administrator.html</p>
</blockquote>
<p>1、创建 Spring Boot 应用，集成 Shiro 及相关组件，pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.1.tmp<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、自定义 Shiro 过滤器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccoutRealm</span> <span class="keyword">extends</span> <span class="title class_">AuthorizingRealm</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 授权</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> principalCollection</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthorizationInfo <span class="title function_">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> &#123;</span><br><span class="line">        <span class="comment">//获取当前登录的用户信息</span></span><br><span class="line">        <span class="type">Subject</span> <span class="variable">subject</span> <span class="operator">=</span> SecurityUtils.getSubject();</span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> (Account) subject.getPrincipal();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置角色</span></span><br><span class="line">        Set&lt;String&gt; roles = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        roles.add(account.getRole());</span><br><span class="line">        <span class="type">SimpleAuthorizationInfo</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthorizationInfo</span>(roles);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置权限</span></span><br><span class="line">        info.addStringPermission(account.getPerms());</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 认证</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> authenticationToken</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> AuthenticationException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        <span class="type">UsernamePasswordToken</span> <span class="variable">token</span> <span class="operator">=</span> (UsernamePasswordToken) authenticationToken;</span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> accountService.findByUsername(token.getUsername());</span><br><span class="line">        <span class="keyword">if</span>(account != <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthenticationInfo</span>(account,account.getPassword(),getName());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 3、配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean <span class="title function_">shiroFilterFactoryBean</span><span class="params">(<span class="meta">@Qualifier(&quot;securityManager&quot;)</span> DefaultWebSecurityManager securityManager)</span>&#123;</span><br><span class="line">        <span class="type">ShiroFilterFactoryBean</span> <span class="variable">factoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">        factoryBean.setSecurityManager(securityManager);</span><br><span class="line">        <span class="comment">//权限设置</span></span><br><span class="line">        Map&lt;String,String&gt; map = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;/main&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;/manage&quot;</span>,<span class="string">&quot;perms[manage]&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;/administrator&quot;</span>,<span class="string">&quot;roles[administrator]&quot;</span>);</span><br><span class="line">        factoryBean.setFilterChainDefinitionMap(map);</span><br><span class="line">        <span class="comment">//设置登录页面</span></span><br><span class="line">        factoryBean.setLoginUrl(<span class="string">&quot;/login&quot;</span>);</span><br><span class="line">        <span class="comment">//设置未授权页面</span></span><br><span class="line">        factoryBean.setUnauthorizedUrl(<span class="string">&quot;/unauth&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> factoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DefaultWebSecurityManager <span class="title function_">securityManager</span><span class="params">(<span class="meta">@Qualifier(&quot;accoutRealm&quot;)</span> AccoutRealm accoutRealm)</span>&#123;</span><br><span class="line">        <span class="type">DefaultWebSecurityManager</span> <span class="variable">manager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>();</span><br><span class="line">        manager.setRealm(accoutRealm);</span><br><span class="line">        <span class="keyword">return</span> manager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> AccoutRealm <span class="title function_">accoutRealm</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AccoutRealm</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ShiroDialect <span class="title function_">shiroDialect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ShiroDialect</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="4-Shiro-整合-Thymeleaf"><a href="#4-Shiro-整合-Thymeleaf" class="headerlink" title="4.Shiro 整合 Thymeleaf"></a>4.Shiro 整合 Thymeleaf</h1><p>1、pom.xml 引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2、配置类添加 ShiroDialect</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ShiroDialect <span class="title function_">shiroDialect</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ShiroDialect</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、index.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span> <span class="attr">xmlns:shiro</span>=<span class="string">&quot;http://www.thymeleaf.org/thymeleaf-extras-shiro&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;shortcut icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>index<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;session.account != null&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;session.account.username&#125;+&#x27;欢迎回来！&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/logout&quot;</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/main&quot;</span>&gt;</span>main<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:hasPermission</span>=<span class="string">&quot;manage&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;manage&quot;</span>&gt;</span>manage<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:hasRole</span>=<span class="string">&quot;administrator&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/administrator&quot;</span>&gt;</span>administrator<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line">=&quot;/main&quot;&gt;main<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:hasPermission</span>=<span class="string">&quot;manage&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;manage&quot;</span>&gt;</span>manage<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:hasRole</span>=<span class="string">&quot;administrator&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/administrator&quot;</span>&gt;</span>administrator<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
 <div>
    
  </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pistachiout.github.io/wiki/Thymeleaf%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Pistachiout">
      <meta itemprop="description" content="Pistachiout的学习博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pistachiout的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/wiki/Thymeleaf%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-16 18:54:55" itemprop="dateCreated datePublished" datetime="2023-02-16T18:54:55+08:00">2023-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-15 10:18:09" itemprop="dateModified" datetime="2023-02-15T10:18:09+08:00">2023-02-15</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-什么是Thymeleaf"><a href="#1-什么是Thymeleaf" class="headerlink" title="1.什么是Thymeleaf"></a>1.什么是Thymeleaf</h1><p>Thymeleaf是一个XML&#x2F;XHTML&#x2F;HTML5模板引擎，可用于Web与非Web环境中的应用开发，它是一个开源的Java库。Thymeleaf提供了一个用于整合Spring MVC的可选模块，在应用开发中，你可以使用Thymeleaf来完全代替JSP或其他模板引擎，如Velocity、FreeMarker等。Thymeleaf的主要目标在于提供一种可被浏览器正确显示的、格式良好的模板创建方式，因此也可以用作静态建模。你可以使用它创建经过验证的XML与HTML模板，它的特点便是：开箱即用。</p>
<h1 id="2-Springboot整合thymeleaf"><a href="#2-Springboot整合thymeleaf" class="headerlink" title="2.Springboot整合thymeleaf"></a>2.Springboot整合thymeleaf</h1><p>实现的步骤为：</p>
<ol>
<li>创建一个sprinboot项目</li>
<li>添加thymeleaf的起步依赖</li>
<li>添加spring web的起步依赖</li>
<li>编写html 使用thymleaf的语法获取变量对应后台传递的值</li>
<li>编写controller 设置变量的值到model中</li>
</ol>
<h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line"> xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line"> xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line"> &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line">​</span><br><span class="line"> &lt;groupId&gt;com.itheima&lt;/groupId&gt;</span><br><span class="line"> &lt;artifactId&gt;springboot-thymeleaf&lt;/artifactId&gt;</span><br><span class="line"> &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line">​</span><br><span class="line"> &lt;parent&gt;</span><br><span class="line"> &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line"> &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line"> &lt;version&gt;<span class="number">2.1</span><span class="number">.4</span>.RELEASE&lt;/version&gt;</span><br><span class="line"> &lt;/parent&gt;</span><br><span class="line">​</span><br><span class="line"> &lt;dependencies&gt;</span><br><span class="line"> &lt;!--web起步依赖</span><br><span class="line"> Tomcat </span><br><span class="line"> Springmvc  引赖Jar包  一个中心 三大组件</span><br><span class="line">--&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line"> &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line"> &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br><span class="line">​</span><br><span class="line"> &lt;!--thymeleaf配置--&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line"> &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line"> &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br><span class="line"> &lt;/dependencies&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h2 id="创建application-yml-并设置thymeleaf的缓存设置，设置为false。"><a href="#创建application-yml-并设置thymeleaf的缓存设置，设置为false。" class="headerlink" title="创建application.yml,并设置thymeleaf的缓存设置，设置为false。"></a>创建application.yml,并设置thymeleaf的缓存设置，设置为false。</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line"> thymeleaf:</span><br><span class="line"> cache: <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<h2 id="在resources中创建templates目录，在templates目录创建index-html-代码如下："><a href="#在resources中创建templates目录，在templates目录创建index-html-代码如下：" class="headerlink" title="在resources中创建templates目录，在templates目录创建index.html,代码如下："></a>在resources中创建templates目录，在templates目录创建index.html,代码如下：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;ch&quot;</span> xmlns:th=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">	&lt;title th:text=<span class="string">&quot;|lookroot-$&#123;title&#125;|&quot;</span>&gt;默认的标题&lt;/title&gt;</span><br><span class="line">	&lt;meta name=<span class="string">&quot;description&quot;</span> th:content=<span class="string">&quot;$&#123;description&#125;&quot;</span>&gt;</span><br><span class="line">	&lt;meta name=<span class="string">&quot;keywords&quot;</span> th:content=<span class="string">&quot;$&#123;keywords&#125;&quot;</span>&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;html xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;</code>这句声明使用thymeleaf标签<br><code>&lt;title th:text=&quot;$&#123;title&#125;&quot;&gt;默认的标题&lt;/title&gt;</code>这句使用 th:text&#x3D;”${变量名}” 表示 使用thymeleaf获取文本数据，类似于EL表达式。</p>
<p><code>&lt;title th:text=&quot;|lookroot-$&#123;title&#125;|&quot;&gt;默认的标题&lt;/title&gt;</code>假如我们的 th:text 标签里面需要拼接字符串${title}可以使用||来包裹</p>
<h2 id="创建controller用于测试后台-设置数据到model中。"><a href="#创建controller用于测试后台-设置数据到model中。" class="headerlink" title="创建controller用于测试后台 设置数据到model中。"></a>创建controller用于测试后台 设置数据到model中。</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IndexController</span> &#123;</span><br><span class="line">   <span class="meta">@GetMapping(&quot;/index&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">index</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;传递的标题&quot;</span>);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;description&quot;</span>, <span class="string">&quot;传递的描述&quot;</span>);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;keywords&quot;</span>, <span class="string">&quot;传递的关键字&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Thymeleaf常用语法"><a href="#Thymeleaf常用语法" class="headerlink" title="Thymeleaf常用语法"></a>Thymeleaf常用语法</h2><p><img data-src="https://img-blog.csdnimg.cn/20210617233419998.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODA4NzAw,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h2 id="渲染对象"><a href="#渲染对象" class="headerlink" title="渲染对象"></a>渲染对象</h2><p>创建一个基本对象UserVO</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserVO</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Integer sex;</span><br><span class="line">    <span class="keyword">private</span> Boolean isVip;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; tags;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新建一个方法basic，将user对象传输到页面中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/basicTrain&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">basic</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">    <span class="type">UserVO</span> <span class="variable">userVO</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserVO</span>();</span><br><span class="line">    userVO.setAge(<span class="number">21</span>);</span><br><span class="line">    userVO.setSex(<span class="number">1</span>);</span><br><span class="line">    userVO.setCreateTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    userVO.setTags(Arrays.asList(<span class="string">&quot;Java&quot;</span>, <span class="string">&quot;PHP&quot;</span>, <span class="string">&quot;Node&quot;</span>));</span><br><span class="line">    userVO.setUsername(<span class="string">&quot;lookroot&quot;</span>);</span><br><span class="line">    model.addAttribute(<span class="string">&quot;user&quot;</span>, userVO);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;basic&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>新建basic.html，此时如果我们想渲染User这个对象的信息我们可以这样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">	&lt;h2 th:text=<span class="string">&quot;$&#123;user.getUsername()&#125;&quot;</span>&gt;&lt;/h2&gt;</span><br><span class="line">	&lt;p th:text=<span class="string">&quot;$&#123;user.getAge()&#125;&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>也可以将User定义为临时变量，接着使用*{xxx}就能取到值了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div th:object=<span class="string">&quot;$&#123;user&#125;&quot;</span>&gt;</span><br><span class="line">	&lt;h2 th:text=<span class="string">&quot;*&#123;username&#125;&quot;</span>&gt;&lt;/h2&gt;</span><br><span class="line">	&lt;p th:text=<span class="string">&quot;*&#123;age&#125;&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>还可以不使用get的方式，直接使用属性名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2 th:text=<span class="string">&quot;$&#123;user.username&#125;&quot;</span> &gt;&lt;/h2&gt;</span><br></pre></td></tr></table></figure>

<h2 id="th-if使用"><a href="#th-if使用" class="headerlink" title="th:if使用"></a><code>th:if</code>使用</h2><p><code>th:if</code>通过布尔值决定这个元素是否渲染</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p th:<span class="keyword">if</span>=<span class="string">&quot;$&#123;user.isVip&#125;&quot;</span>&gt;会员&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<h2 id="th-each使用"><a href="#th-each使用" class="headerlink" title="th:each使用"></a><code>th:each</code>使用</h2><p>th:each可以迭代循环出数据，前面我们User对象里面的tags是一个数组，我们来渲染一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">   &lt;li th:each=<span class="string">&quot;tag:$&#123;user.getTags()&#125;&quot;</span> </span><br><span class="line">       th:text=<span class="string">&quot;$&#123;tag&#125;&quot;</span>&gt;&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>
<p>状态变量在th:each属性中定义，并且包含以下数据：</p>
<blockquote>
<p>当前的迭代索引，从0开始。这是index属性。.<br> 从1开始的当前迭代索引。这是count属性。<br>  迭代变量中元素的总数。这是size财产。<br>每次迭代的iter变量。这是current财产。<br>当前迭代是偶数还是奇数。这些是even&#x2F;odd布尔属性。<br>当前迭代是否是第一个。这是first布尔属性。<br>当前迭代是否为最后一次。这是last布尔属性</p>
</blockquote>
<h2 id="th-switch使用"><a href="#th-switch使用" class="headerlink" title="th:switch使用"></a><code>th:switch</code>使用</h2><p>th:switch选择语句</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div th:<span class="keyword">switch</span>=<span class="string">&quot;$&#123;user.getSex()&#125;&quot;</span>&gt;</span><br><span class="line">	&lt;p th:<span class="keyword">case</span>=<span class="string">&quot;&#x27;1&#x27;&quot;</span>&gt;男&lt;/p&gt;</span><br><span class="line">	&lt;p th:<span class="keyword">case</span>=<span class="string">&quot;&#x27;2&#x27;&quot;</span>&gt;女&lt;/p&gt;</span><br><span class="line">	&lt;p th:<span class="keyword">case</span>=<span class="string">&quot;*&quot;</span>&gt;默认&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h2 id="url"><a href="#url" class="headerlink" title="url"></a>url</h2><p>如果在springboot中需要引入static目录下的静态资源可以使用@{xxx}的方式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link th:href=<span class="string">&quot;@&#123;/app.css&#125;&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br></pre></td></tr></table></figure>

<h2 id="JavaScript动态渲染"><a href="#JavaScript动态渲染" class="headerlink" title="JavaScript动态渲染"></a>JavaScript动态渲染</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">th:inline</span>=<span class="string">&quot;javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> user = <span class="comment">/*[[$&#123;user&#125;]]*/</span> &#123;&#125;;</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">console</span>.<span class="title function_">log</span>(user);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>同理css也是可以的</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">th:inline</span>=<span class="string">&quot;css&quot;</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.main</span>\ elems &#123;</span></span><br><span class="line"><span class="language-css">      <span class="attribute">text-align</span>: <span class="comment">/*[[$&#123;align&#125;]]*/</span> left;</span></span><br><span class="line"><span class="language-css">    &#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="Thymeleaf碎片（组件）"><a href="#Thymeleaf碎片（组件）" class="headerlink" title="Thymeleaf碎片（组件）"></a>Thymeleaf碎片（组件）</h1><h2 id="th-fragment"><a href="#th-fragment" class="headerlink" title="th:fragment"></a><code>th:fragment</code></h2><p>新建一个component.html,一个文件里面可以写多个碎片，使用<code>th:fragment</code>来定义</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">th:fragment</span>=<span class="string">&quot;com1&quot;</span>&gt;</span></span><br><span class="line">	this is com1</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">id</span>=<span class="string">&quot;com2&quot;</span>&gt;</span></span><br><span class="line">	this is com2</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用碎片主要有两种方式replace和insert,在index.html中编写</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--replace--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:replace</span>=<span class="string">&quot;~&#123;component::com1&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--insert--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">&quot;~&#123;component::com1&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这两种方式的区别就是，replace会将新标签完全替换原本的标签，也就是说原本写th:replace属性的标签就不会渲染出来，insert是往这个地方插入标签</p>
<h2 id="直接通过选择器使用"><a href="#直接通过选择器使用" class="headerlink" title="直接通过选择器使用"></a>直接通过选择器使用</h2><p>对于碎片，甚至可以不定义，我们再次添加一个 碎片</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">id</span>=<span class="string">&quot;com2&quot;</span>&gt;</span></span><br><span class="line">	this is com2</span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后使用它</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">&quot;~&#123;component::#com2&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="注释类型"><a href="#注释类型" class="headerlink" title="注释类型"></a>注释类型</h2><p>在碎片里面，我们是可以使用控制传递的数据的，比如上面的User对象，但是开发工具在component.html页面中可能不能识别到User对象，我们可以打一个注释</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--/*@thymesVar id=&quot;user&quot; type=&quot;cn.lookroot.loop.thymeleafdemo.vo.UserVO&quot;*/--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user.getUsername()&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="组件传递参数"><a href="#组件传递参数" class="headerlink" title="组件传递参数"></a>组件传递参数</h2><p>组件也是可以传递数据的</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">&quot;com3(message)&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;message&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用的时候</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">&quot;~&#123;component::com3(&#x27;传递数据&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="局部替换组件"><a href="#局部替换组件" class="headerlink" title="局部替换组件"></a>局部替换组件</h2><p>我们使用一个组件的时候，想要局部替换掉这个组件里面的部分内容该怎么做呢？通过传递参数的方式传递一个组件过来，并把这个组件替换原本的一部分</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">&quot;com4(message)&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">p</span> <span class="attr">th:replace</span>=<span class="string">&quot;$&#123;message&#125;&quot;</span>&gt;</span>原本的message<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>使用的时候</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">th:insert</span>=<span class="string">&quot;~&#123;component::com4(~&#123;::#message&#125;)&#125;&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;message&quot;</span>&gt;</span>替换的message<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="基本对象"><a href="#基本对象" class="headerlink" title="基本对象"></a>基本对象</h1><h2 id="ctx：上下文对象"><a href="#ctx：上下文对象" class="headerlink" title="ctx：上下文对象"></a>ctx：上下文对象</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$&#123;#ctx.request&#125;</span><br><span class="line">$&#123;#ctx.response&#125;</span><br><span class="line">$&#123;#ctx.session&#125;</span><br><span class="line">$&#123;#ctx.servletContext&#125;</span><br></pre></td></tr></table></figure>

<h2 id="请求-x2F-会话属性"><a href="#请求-x2F-会话属性" class="headerlink" title="请求&#x2F;会话属性"></a>请求&#x2F;会话属性</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$&#123;session.xxx&#125;                 </span><br><span class="line">$&#123;application.xxx&#125;          </span><br><span class="line">$&#123;#request.getAttribute(&#x27;xxx&#x27;)&#125;</span><br></pre></td></tr></table></figure>

<h2 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h2><p>在thymeleaf里面是可以直接使用一些Java的函数的，并且你可以通过传递参数的方式把一些自己写的方法传递给页面，在里面调用也是可以的</p>
<blockquote>
<p>#dates<br>#calendars<br>#strings<br>#numbers<br>#objects<br>#bools<br>#arrays<br>#lists<br>#sets<br>#maps<br>#aggregates</p>
</blockquote>
<p>以日期格式化来举例</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--日期格式化--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;#dates.format(user.createTime,&#x27;yyyy-MM-dd HH:mm&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
 <div>
    
  </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pistachiout.github.io/wiki/SSM%E9%A1%B9%E7%9B%AE%E4%B8%8A%E4%BC%A0%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Pistachiout">
      <meta itemprop="description" content="Pistachiout的学习博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pistachiout的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/wiki/SSM%E9%A1%B9%E7%9B%AE%E4%B8%8A%E4%BC%A0%E4%BA%91%E6%9C%8D%E5%8A%A1%E5%99%A8/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-16 18:54:55" itemprop="dateCreated datePublished" datetime="2023-02-16T18:54:55+08:00">2023-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-15 10:18:18" itemprop="dateModified" datetime="2023-02-15T10:18:18+08:00">2023-02-15</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>515</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-购买服务器"><a href="#1-购买服务器" class="headerlink" title="1.购买服务器"></a><em><strong>1.购买服务器</strong></em></h2><p><a target="_blank" rel="noopener" href="https://www.aliyun.com/activity/new?spm=5176.19720258.J_2937333540.4.22e32c4a5PdG0z">阿里云新人免费领取网站</a><br><a target="_blank" rel="noopener" href="https://cloud.tencent.com/act/free">腾讯云新人免费领取网站</a><br>领取后在控制台进行操作，可以发现公网ip地址与重置密码，之后记住修改服务器安全组规则，打开8080端口</p>
<hr>
<h2 id="2-连接服务器"><a href="#2-连接服务器" class="headerlink" title="2.连接服务器"></a>2.连接服务器</h2><p>开始菜单输入mstsc打开远程桌面连接输入ip地址，用户名Administrator与密码连接。</p>
<hr>
<h2 id="3-配置相应环境"><a href="#3-配置相应环境" class="headerlink" title="3.配置相应环境"></a>3.配置相应环境</h2><p><a target="_blank" rel="noopener" href="https://download.csdn.net/download/qq_45808700/85134959">环境全套配置资源</a></p>
<p>首先一定要配置好jdk，Tomcat，MySQL，可以自己去官网下载，全部安装后点开控制面板，在系统高级设置中配置环境变量</p>
<table>
<thead>
<tr>
<th>变量名</th>
<th>变量值</th>
</tr>
</thead>
<tbody><tr>
<td>JAVA_HOME</td>
<td>jdk安装的路径</td>
</tr>
<tr>
<td>CLASSPATH</td>
<td></td>
</tr>
<tr>
<td>Path</td>
<td>%JAVA_HOME%\bin;%JAVA_HOME%\jre\bin</td>
</tr>
<tr>
<td>CATALINA_BASE</td>
<td>tomcat的安装路径</td>
</tr>
<tr>
<td>CATALINA_HOME</td>
<td>tomcat的安装路径</td>
</tr>
<tr>
<td>TOMCAT_HOME</td>
<td>tomcat的安装路径</td>
</tr>
<tr>
<td>mysql数据库首先记得利用Navicat创建好</td>
<td></td>
</tr>
</tbody></table>
<h2 id="4-打开Tomcat"><a href="#4-打开Tomcat" class="headerlink" title="4.打开Tomcat"></a>4.打开Tomcat</h2><p>打开cmd命令行窗口，cd进入Tomcat安装路径&#x2F;bin，运行startup.bat。在网页输入ip:8080检测</p>
<h2 id="5-上传SSM项目"><a href="#5-上传SSM项目" class="headerlink" title="5.上传SSM项目"></a>5.上传SSM项目</h2><p>从idea中利用Maven进行packge打包，打包后的war包先更改为ROOT名称，这样服务器首页就是该项目。</p>

      
    </div>

    
    
    
 <div>
    
  </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://pistachiout.github.io/wiki/IDEA%20web%E9%A1%B9%E7%9B%AE%E6%9C%AC%E5%9C%B0%E7%83%AD%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Pistachiout">
      <meta itemprop="description" content="Pistachiout的学习博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pistachiout的博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/wiki/IDEA%20web%E9%A1%B9%E7%9B%AE%E6%9C%AC%E5%9C%B0%E7%83%AD%E9%83%A8%E7%BD%B2/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-02-16 18:54:55" itemprop="dateCreated datePublished" datetime="2023-02-16T18:54:55+08:00">2023-02-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-15 10:18:25" itemprop="dateModified" datetime="2023-02-15T10:18:25+08:00">2023-02-15</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>511</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本地热部署是能够在项目运行中感知到特定文件代码的修改而使项目<strong>不重新启动</strong>就能生效。</p>
<p>使用热部署后：<br>run 模式运行：当修改 jsp 文件时不需要重启 tomcat<br><strong><strong><strong>debug</strong></strong></strong> 模式运行：修改类不需要重启服务器，重新编译之后直接刷新页面就会更新</p>
<h2 id="1、SSM热部署，修改-Tomcat-配置"><a href="#1、SSM热部署，修改-Tomcat-配置" class="headerlink" title="1、SSM热部署，修改 Tomcat 配置"></a>1、SSM热部署，修改 Tomcat 配置</h2><p><strong>设置File -&gt; Settings -&gt; Build,Execution,Deployment -&gt; Compiler -&gt; Build project automatically</strong><br><img data-src="https://img-blog.csdnimg.cn/75e972d3167b478ea4c17a03d73a07da.png" alt="在这里插入图片描述"><br><img data-src="https://img-blog.csdnimg.cn/4ab7eb3d670341cf8649c61a794281a1.png" alt="在这里插入图片描述"></p>
<h2 id="2-Springboot热部署"><a href="#2-Springboot热部署" class="headerlink" title="2.Springboot热部署"></a>2.Springboot热部署</h2><p>pom.xml引入依赖</p>
<!--热部署-->
<pre><code>    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
        &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;optional&gt;true&lt;/optional&gt;
    &lt;/dependency&gt;
</code></pre>
<p>然后按<strong>crtl+F9</strong></p>
<p><strong>热部署Crtl+F9重新编译</strong>（页面修改及后台代码修改都可以）</p>

      
    </div>

    
    
    
 <div>
    
  </div>
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Pistachiout"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Pistachiout</p>
  <div class="site-description" itemprop="description">Pistachiout的学习博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">54</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Pistachiout" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Pistachiout" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/qq_45808700?spm=1010.2135.3001.5343" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_45808700?spm&#x3D;1010.2135.3001.5343" rel="noopener" target="_blank"><i class="fa csdn fa-fw"></i>CSDN</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_sphere.min.js"></script>


  















      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Pistachiout</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">263k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">3:59</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->

<!-- <br /> -->
<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<!-- <span id="times">载入时分秒...</span> -->
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("02/15/2023 8:00:00");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); 
        if(String(snum).length ==1 ){snum = "0" + snum;}
        // var times = document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "+hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>
        








      </div>
    </footer>
  </div>
  

  



<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":140,"height":240},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
